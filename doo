#!/usr/bin/env php
<?php

    if (isset($argv[1])) {

        if(!isset($argv[1])) {

            makeMessage(APP_NOT_GIVEN);

        }

        if(!preg_match("#^[A-Za-z_-]+[0-9_-]*$#", $argv[1])) {

            die("Prject name not accepted ...\n");

        }

        $path = initProjet($argv[1]);

        // Si vous avez desider de creer votre dsn de connection
        if(isset($argv[2]) && $argv[2] == "--dsn") {

            if(isset($argv[3])) {

                if(!verifyDsn($argv[3])) {

                    die("Dsn isn't valide.\n");

                }

                createDsn($argv[3], $argv[1]);
            
            } else {

                die("You not give --dsn value.\n\tUsgae doo init projet-name --dsn Your-Dsn\n\te.g mysql://root:password@localhost:3306/mydatabase\n");
            
            }

        }

    } else {

        die("Destination is empty\n\taborting ...!\n");

    }

function initProjet($projetName) {

$data['autoload'] = <<< EOPAGE
PD9waHANCg0KbmFtZXNwYWNlIERvbzsNCg0KLyoqDQoqIEF1dG9sb2FkZXINCiovDQpjbGFzcyBBdXRvbG9hZA0Kew0KDQoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiByZWdpc3RlcigpDQoJew0KDQoJCXNwbF9hdXRvbG9hZF9yZWdpc3RlcihbX19DTEFTU19fLCAibG9hZCJdKTsNCg0KCX0NCg0KCXByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIGxvYWQoJGNsYXNzKQ0KCXsNCg0KCQkkY2xhc3MgPSBzdHJfcmVwbGFjZShfX05BTUVTUEFDRV9fIC4gIlxcIiwgIiIsICRjbGFzcyk7DQoNCgkJJGNsYXNzID0gX19ESVJfXyAuICcvJyAuICRjbGFzczsNCg0KCQkkY2xhc3MgPSBzdHJfcmVwbGFjZSgiXFwiLCAiLyIsICRjbGFzcyk7DQoNCgkJcmVxdWlyZSAkY2xhc3MgLiAnLnBocCc7DQoNCgl9DQoNCn0NCg==
EOPAGE;

$data['doo'] = <<< EOPAGE
PD9waHANCg0KLyoqDQoqIFBIUCwgdW5lIGNsYXNzZSBQSFAgc2ltcGxlLiBEYW5zIGxlIGJ1dCBzaW1wbGlmacOpIGwndXRpbGlzYXRpb24gZGUgUERPDQoqIEBhdXRob3IgRGFraWEgRnJhbmNrIDxkYWtpYWZyYW5ja2luZm9AZ21haWwuY29tPg0KKiBAcGFja2FnZSBEb287DQoqIEB2ZXJzaW9uIDAuMS4wDQoqLw0KbmFtZXNwYWNlIERvbzsNCg0KLyoqDQogKiBDbGFzcyBEb28NCiAqDQogKiBAcGFja2FnZSBEb28NCiAqLw0KY2xhc3MgRG9vIGV4dGVuZHMgRG9vRGF0YXsNCg0KICAgIC8qKg0KICAgICogU3VwZXIgY29uc3RhbnRlLCBwZXJtZXRhbnQgZGUgc2ltcGxpZmllciBsZSBpbmZvcm1hdGlvbiBzdXIgbGVzIGVycmV1cnMNCiAgICAqLw0KICAgIGNvbnN0IEVSUk9SID0gIDM7DQogICAgY29uc3QgU1VDQ0VTUyA9ICAyOw0KICAgIGNvbnN0IFdBUk5JTkcgPSAxOw0KDQogICAgIyBjb25maWd1cmF0aW9uIGR1IGpldSBkZSBjYXJhY3RlcmUNCiAgICBwcml2YXRlIHN0YXRpYyAkY2hhcnNldCA9IG51bGw7DQoNCiAgICAjIG1haWwNCiAgICBwdWJsaWMgc3RhdGljICRtYWlsID0gbnVsbDsNCg0KICAgICMgTGUgbW9kZSBkZSByZWN1cGVyYXRpb24gZGUgZGVzDQogICAgcHJpdmF0ZSBzdGF0aWMgJG1vZGVEZVJlY3VwZXJhdGlvbkRlRG9ubmVlID0gXFBETzo6RkVUQ0hfT0JKOw0KDQogICAgIyBPYmplY3QgZGUgY29ubmVjdGlvbiBQRE8NCiAgICBwcml2YXRlIHN0YXRpYyAkYmRkID0gbnVsbDsNCg0KICAgICMgRmV0Y2ggTW9kZQ0KICAgIGNvbnN0IE9CSkVDVCA9IFxQRE86OkZFVENIX09CSjsNCiAgICBjb25zdCBBU1NPQyA9IFxQRE86OkZFVENIX0FTU09DOw0KICAgIGNvbnN0IE5VTSA9IFxQRE86OkZFVENIX05VTTsNCg0KICAgICMgcmVwZXJ0b2lyZSBwYXIgZGVmYXV0IGQndXBsb2FkIGRlIGZpY2hpZXINCiAgICBwcml2YXRlIHN0YXRpYyAkdXBsb2FkRGlyID0gInVwbG9hZGVkIjsNCg0KICAgICMgdGFpbGxlIGR1IGZpY2hpZXINCiAgICBwcml2YXRlIHN0YXRpYyAkZmlsZVNpemUgPSAyMDAwMDAwOw0KDQogICAgIyBtYWlsIHNpZ2xldG9uDQogICAgcHJpdmF0ZSBzdGF0aWMgJG1haWwgPSBudWxsOw0KDQogICAgLyoqDQogICAgKiBpbml0aWFsaXNhdGlvbiBkZSBsYSBjaGFpbmUgZGUgY29ubmVjdGlvbg0KICAgICogZS5nIG15c3FsOi8vdXNlcm5hbWU6cGFzc3dvcmRAaG9zdG5hbWU6cG9ydC9kYm5hbWUNCiAgICAqLw0KDQogICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCkNCiAgICB7DQogICAgICAgIHNlbGY6OiRtYWlsID0gbmV3IERvb21haWwoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGluaXQoJGRzbiA9IG51bGwsICRjYiA9IG51bGwpDQogICAgew0KDQogICAgICAgIGlmKCRkc24gIT09IG51bGwpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmKCFpc19zdHJpbmcoJGRzbikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgJGNiID0gJGRzbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZigkY2IgIT09IG51bGwpDQogICAgICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgICAgIHNlbGY6OiRiZGQgPSBEb286OmNvbm5lY3Rpb24oJGRzbiwgJGNiKTsNCg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzZWxmOjokYmRkID0gRG9vZGI6OmNvbm5lY3Rpb24oJGNiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQogICAgICAgIGlmKHNlbGY6OiRiZGQgIT09IG51bGwpDQogICAgICAgIHsNCg0KICAgICAgICAgICAgaWYoc2VsZjo6JGNoYXJzZXQgIT09IG51bGwpDQogICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICBzZWxmOjokYmRkLT5leGVjKCJTRVQgTkFNRVMgIiAuIHNlbGY6OiRjaGFyc2V0KTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0NCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICogc2V0Q2hhcnNldCwgcGVybWV0IGRlIHJlaW5pdGlhbGlzZXIgbGUgamV1eCBkZSBjYXJhY3Rlcg0KICAgICogQHBhcmFtIHN0cnRpbmc6IGVuY29kYWdlDQogICAgKiBAcGFyYW0gbnVsbCBjYg0KICAgICogQHJldHVybiBtaXhlZA0KICAgICovDQoNCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHNldENoYXJzZXQoJGNoYXJzZXQsICRjYiA9IG51bGwpDQogICAgew0KDQogICAgICAgIGlmKCFpbl9hcnJheSgkY2hhcnNldCwgWyJVVEY4IiwgIklTTy04ODU5Il0pKXsNCg0KICAgICAgICAgICAgaWYoJGNiICE9PSBudWxsKQ0KICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxfdXNlcl9mdW5jX2FycmF5KCRjYiwgW25ldyBcRXhjZXB0aW9uKCdFbmNvZGFnZSBub24gdmFsaWRlJyldKTsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgc2VsZjo6ZG9FeGNlcHRpb24oJGNiLCAiRW5jb2RhZ2Ugbm9uIHZhbGlkZSIsIHNlbGY6OldBUk5JTkcpOw0KICAgICAgICAgICAgICAgIGV4aXQoKTsNCg0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0NCiAgICAgICAgZWxzZQ0KICAgICAgICB7DQoNCg0KDQogICAgICAgIH0NCg0KICAgICAgICBzZWxmOjokY2hhcnNldCA9ICRjaGFyc2V0Ow0KDQogICAgICAgIGlmKCRjYiAhPT0gbnVsbCkNCiAgICAgICAgew0KDQogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkY2IsIG51bGwpOw0KDQogICAgICAgIH0NCg0KICAgIH0NCiAgICAvKioNCiAgICAqIHNldEZldGNoTW9kZSwgZm9uY3Rpb24gcGVybWV0dGFudCBkZSByZWRlZmluaXIgbGEgbWV0aG9kZSBkZSByZWN1cGVyYXRpb24gZGVzIGluZm9ybWF0aW9uDQogICAgKiBAcGFyYW0gaW50OiBQRE8gZmVjdGggY29uc3RhbnQNCiAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gc2V0RmV0Y2hNb2RlKCRwZG9GZXRjaE1vZGUpDQogICAgew0KDQogICAgICAgIHNlbGY6OiRtb2RlRGVSZWN1cGVyYXRpb25EZURvbm5lZSA9IChpbnQpICRwZG9GZXRjaE1vZGU7DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAqIHNlbGVjdDogZm9uY3Rpb24gcGVybWV0dGFudCBkJ2V4ZWN1dGVyIHRvdXQgZm9ybWUgZGUgcmVxdWV0dGUgZGUgdHlwZSBTRUxFQ1QNCiAgICAqDQogICAgKiBAcGFyYW0gc3RyaW5nIHRhYmxlIDogbGEgdGFibGUgc3VyIGxhcXVlbGxlIGZhaXJlIGxhIHNlbGVjdGlvbg0KICAgICogQHBhcmFtIGFycmF5IGZpZWxkcyA6IGxpc3RlIGRlIGNvbG9ubmUgw6AgdmlzdWFsaXNlcg0KICAgICogQHBhcmFtIGZ1bmN0aW9uIGNiOiBmb25jdGlvbiBkZSByZWN1cGVyYXRpb24gZGVzIGVycmV1cnMgZXQgZGVzIGRvbm5lZXMNCiAgICAqIEBwYXJhbSBhcnJheSBbd2hlcmUgPSBudWxsXTogY29uZGl0aW9uIHN1cHBsZW1lbnRhaXJlDQogICAgKiBAcGFyYW0gYm9vbGVhbiBvcmRlcjogT1JERVIgQlkNCiAgICAqIEBwYXJhbSBzdHJpbmcgbGltaXQNCiAgICAqIEB0aHJvd3MgXEV4Y2VwdGlvbg0KICAgICovDQoNCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHNlbGVjdCgkdGFibGUsICRmaWVsZHMsICRjYiwgJHdoZXJlID0gbnVsbCwgJG9yZGVyID0gZmFsc2UsICRsaW1pdCA9IG51bGwpDQogICAgew0KDQogICAgICAgIHNlbGY6OmRvRXhjZXB0aW9uKCRjYiwgIkV4ZWN1dGV6IGVuIHByZW1pZXIgY2V0dGUgY29tbWFuZGUsIERvbzo6aW5pdChkc24sIGNiKS4gIik7DQoNCiAgICAgICAgIyBVbmUgY2hhaW5lIGNvbnRlbmFudCB1biBsaXN0ZSBkZSBjb2xvbm5lIGRlcyBlbGVtZW50cyBlbiB2aXN1YWxpc2VyDQogICAgICAgICRmaWVsZHMgPSBpbXBsb2RlKCIsICIsICRmaWVsZHMpOw0KDQogICAgICAgICMgU3RhdGVtZW50IHBhciBkZWZhdXQNCiAgICAgICAgJHF1ZXJ5ID0gIlNFTEVDVCAiIC4gJGZpZWxkcyAuICIgRlJPTSAiIC4gJHRhYmxlOw0KDQoNCiAgICAgICAgIyBDb25zdHJ1Y3Rpb24gZCd1biBTUUwgc3RhdGVtZW50IHBlcnNvbm5hbGlzYWJsZQ0KICAgICAgICBpZigkd2hlcmUgIT09IG51bGwgJiYgaXNfYXJyYXkoJHdoZXJlKSkNCiAgICAgICAgew0KDQogICAgICAgICAgICAkYyA9IGNvdW50KCR3aGVyZSk7DQoNCiAgICAgICAgICAgIGlmKCRjID09IDEpIHsNCg0KICAgICAgICAgICAgICAgICRxdWVyeSAuPSAiIFdIRVJFICIgLiBpbXBsb2RlKCIsIiwgJHdoZXJlKTsNCg0KICAgICAgICAgICAgfSBlbHNlIGlmKCRjID09IDIpIHsNCg0KICAgICAgICAgICAgICAgIGlmKGlzX2FycmF5KCRvcmRlcikgJiYgY291bnQoJG9yZGVyKSA9PSAyKSB7DQogICAgICAgICAgICAgICAgICAgICMgRW1pc3Npb24gZCdlcnJldXINCiAgICAgICAgICAgICAgICAgICAgc2VsZjo6ZG9FeGNlcHRpb24oJGNiLCAiU3ludGF4IGVycm9yLCBsZSBwYXJhbWV0cmUgYXByZXMgbGEgZm9uY3Rpb24gZXN0IHVuIHdoZXJlIGRlICIpOw0KDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYoaXNfc3RyaW5nKCRvcmRlcikpIHsNCg0KICAgICAgICAgICAgICAgICAgICAkbGltaXQgPSAkb3JkZXI7DQoNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0gZWxzZSB7DQoNCiAgICAgICAgICAgICAgICBpZihpc19zdHJpbmcoJG9yZGVyKSkgew0KDQogICAgICAgICAgICAgICAgICAgICRsaW1pdCA9ICRvcmRlcjsNCiAgICAgICAgICAgICAgICAgICAgJG9yZGVyID0gJHdoZXJlOw0KDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0gZWxzZSBpZihpc19zdHJpbmcoJHdoZXJlKSkgew0KDQogICAgICAgICAgICAkbGltaXQgPSAkd2hlcmU7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGlmKGlzX2FycmF5KCRvcmRlcikgJiYgY291bnQoJG9yZGVyKSA9PSAyKSB7DQoNCiAgICAgICAgICAgICRxdWVyeSAuPSAiIE9SREVSIEJZICIgLiAkb3JkZXJbMF07DQoNCiAgICAgICAgICAgIGlmKGVuZCgkb3JkZXIpID09PSB0cnVlKSB7DQoNCiAgICAgICAgICAgICAgICAgJHF1ZXJ5IC49ICIgREVTQyI7DQoNCiAgICAgICAgICAgIH0gZWxzZSB7DQoNCiAgICAgICAgICAgICAgICAkcXVlcnkgLj0gIiBBU0MiOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgfSBlbHNlaWYoaXNfc3RyaW5nKCRvcmRlcikpIHsNCg0KICAgICAgICAgICAgJGxpbWl0ID0gJG9yZGVyOw0KDQogICAgICAgIH0NCg0KICAgICAgICBpZigkbGltaXQgIT09IG51bGwpDQogICAgICAgIHsNCg0KICAgICAgICAgICAgJHF1ZXJ5IC49ICIgTElNSVQgIiAuICRsaW1pdDsNCg0KICAgICAgICB9DQoNCiAgICAgICAgaWYoc2VsZjo6JGNoYXJzZXQgIT09IG51bGwpDQogICAgICAgIHsNCg0KICAgICAgICAgICAgc2VsZjo6JGJkZC0+ZXhlYygiU0VUIE5BTUVTICIgLiBzZWxmOjokY2hhcnNldCk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgICRyZXEgPSBzZWxmOjokYmRkLT5xdWVyeSgkcXVlcnkpOw0KDQoNCiAgICAgICAgJGVyciA9IHNlbGY6OmdldEVycm9yKHNlbGY6OiRiZGQtPmVycm9ySW5mbygpLCAkcXVlcnkpOw0KDQogICAgICAgIGlmKGlzX2Jvb2woJHJlcSkpDQogICAgICAgIHsNCg0KICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmNfYXJyYXkoJGNiICwgWyRlcnIsIFtdXSk7DQoNCiAgICAgICAgfWVsc2UNCiAgICAgICAgew0KDQogICAgICAgICAgICBjYWxsX3VzZXJfZnVuY19hcnJheSgkY2IsIFskZXJyLCAkcmVxLT5mZXRjaEFsbChzZWxmOjokbW9kZURlUmVjdXBlcmF0aW9uRGVEb25uZWUpXSk7DQoNCiAgICAgICAgfQ0KDQogICAgfQ0KDQogICAgLyoqDQogICAgKiB1cGRhdGU6IGZvbmN0aW9uIHBlcm1ldHRhbnQgZCdleGVjdXRlciB0b3V0IGZvcm1lIGRlIHJlcXVldHRlIGRlIHR5cGUgVVBEQVRFDQogICAgKiBAcGFyYW0gc3RyaW5nIHRhYmxlOiBsYSB0YWJsZSBzdXIgbGFxdWVsbGUgZmFpcmUgbGEgc2VsZWN0aW9uDQogICAgKiBAcGFyYW0gYXJyYXkgZmllbGRzOiBsaXN0ZSBkZSBjb2xvbm5lIMOgIG1ldHRyZSBhIGpvdXINCiAgICAqIEBwYXJhbSBmdW5jdGlvbiBjYjogZm9uY3Rpb24gZGUgcmVjdXBlcmF0aW9uIGRlcyBlcnJldXJzIGV0IGRlcyBkb25uZWVzDQogICAgKiBAcGFyYW0gc3RyaW5nIHdoZXJlOiB3aGVyZSBjb25kaXRpb24sIHsgaWQgPSAyIGFuZCB9DQogICAgKi8NCg0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gdXBkYXRlKCR0YWJsZSwgJGZpZWxkcywgJGNiID09IG51bGwsICR3aGVyZSA9IG51bGwpDQogICAgew0KICAgICAgICBzZWxmOjpkb0V4Y2VwdGlvbigkY2IsICJFeGVjdXRleiBlbiBwcmVtaWVyIGNldHRlIGZvbmN0aW9uLCBEb286OmluaXQoZHNuLCBjYikuIDxici8+IG91IHZlcmlmaWV6IGNldHRlIGZvbmN0aW9uLiIpOw0KDQogICAgICAgIGlmKCRjYiAhPT0gbnVsbCkgew0KDQogICAgICAgICAgICBpZihpc19zdHJpbmcoJGNiKSkgew0KDQogICAgICAgICAgICAgICAgJHdoZXJlID0gJGNiOw0KICAgICAgICAgICAgICAgICRjYiA9IG51bGw7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgICRmaWVsZCA9ICcnOw0KICAgICAgICAkaSA9IDA7DQoNCiAgICAgICAgZm9yZWFjaCgkZmllbGRzIGFzICRrZXkgPT4gJHZhbHVlKSB7DQoNCiAgICAgICAgICAgIGlmKGlzX3N0cmluZygkdmFsdWUpKSB7DQogICAgICAgICAgICAgICAgJHZhbHVlID0gIid7JHZhbHVlfSciOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkZmllbGQgLj0gKCRpID4gMCA/ICIsICIgOiAiIikgLiAgInska2V5fSA9IHskdmFsdWV9IjsNCiAgICAgICAgICAgICRpKys7DQoNCiAgICAgICAgfQ0KDQogICAgICAgICRxdWVyeSA9ICJVUERBVEUgIiAuICR0YWJsZSAuICIgU0VUICIgLiAkZmllbGQ7DQoNCiAgICAgICAgaWYoaXNfc3RyaW5nKCR3aGVyZSkpIHsNCg0KICAgICAgICAgICAgJHF1ZXJ5IC49ICIgV0hFUkUgIiAuICR3aGVyZTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZjo6JGJkZC0+ZXhlYygkcXVlcnkpOw0KDQogICAgICAgIGlmKCRjYiAhPT0gbnVsbCkgew0KDQogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkY2IsIHNlbGY6OmdldEVycm9yKHNlbGY6OiRiZGQtPmVycm9ySW5mbygpLCAkcXVlcnkpKTsNCg0KICAgICAgICB9DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAqIGluc2VydDogZm9uY3Rpb24gcGVybWV0dGFudCBkJ2V4ZWN1dGVyIHRvdXQgZm9ybWUgZGUgcmVxdWV0dGUgZGUgdHlwZSBJTlNFUlQNCiAgICAqIEBwYXJhbSBzdHJpbmcgdGFibGUgOiBsYSB0YWJsZSBzdXIgbGFxdWVsbGUgZmFpcmUgbGEgc2VsZWN0aW9uDQogICAgKiBAcGFyYW0gYXJyYXkgZmllbGRzOiBsaXN0ZSBkZSBjb2xvbm5lIMOgIGluc2VyZXINCiAgICAqIEBwYXJhbSBmdW5jdGlvbiBjYjogZm9uY3Rpb24gZGUgcmVjdXBlcmF0aW9uIGRlcyBlcnJldXJzIGV0IGRlcyBkb25uZWVzDQogICAgKi8NCg0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gaW5zZXJ0KCR0YWJsZSwgJGZpZWxkcywgJGNiKQ0KICAgIHsNCg0KICAgICAgICBzZWxmOjpkb0V4Y2VwdGlvbigkY2IsICJFeGVjdXRleiBlbiBwcmVtaWVyIGNldHRlIGNvbW1hbmRlLCBEb286OmluaXQoZHNuLCBjYikuICIpOw0KDQogICAgICAgICRxdWVyeSA9ICJJTlNFUlQgSU5UTyB7JHRhYmxlfSBTRVQgIjsNCg0KICAgICAgICAkaSA9IDA7DQoNCiAgICAgICAgZm9yZWFjaCAoJGZpZWxkcyBhcyAka2V5ID0+ICR2YWx1ZSkNCiAgICAgICAgew0KDQogICAgICAgICAgICAkcXVlcnkgLj0gJGkgPiAwID8gIiwgIiA6ICIiOw0KICAgICAgICAgICAgJHF1ZXJ5IC49ICAieyRrZXl9ID0gOnska2V5fSI7DQogICAgICAgICAgICAkaSsrOw0KDQogICAgICAgIH0NCg0KICAgICAgICAkcmVxID0gc2VsZjo6JGJkZC0+cHJlcGFyZSgkcXVlcnkpOw0KDQogICAgICAgIGZvcmVhY2goJGZpZWxkcyBhcyAka2V5ID0+ICR2YWx1ZSkNCiAgICAgICAgew0KDQogICAgICAgICAgICAkcmVxLT5iaW5kVmFsdWUoInska2V5fSIsICR2YWx1ZSwgaXNfaW50KCR2YWx1ZSkgPyBcUERPOjpQQVJBTV9JTlQgOiBcUERPOjpQQVJBTV9TVFIpOw0KDQogICAgICAgIH0NCg0KICAgICAgICAkcmVxLT5leGVjdXRlKCk7DQoNCiAgICAgICAgJGNiKHNlbGY6OmdldEVycm9yKHNlbGY6OiRiZGQtPmVycm9ySW5mbygpLCAkcXVlcnkpKTsNCg0KICAgIH0NCg0KDQogICAgLyoqDQogICAgKiBkZWxldGU6IGZvbmN0aW9uIHBlcm1ldHRhbnQgZCdleGVjdXRlciB0b3V0IGZvcm1lIGRlIHJlcXVldHRlIGRlIHR5cGUgREVMRVRFDQogICAgKiBAcGFyYW0gc3RyaW5nIHRhYmxlDQogICAgKiBAcGFyYW0gYXJyYXkgd2hlcmU6IGlkIGRlcyBjb2xvbm5lcyDDoCBzdXBwcmltZXINCiAgICAqIEBwYXJhbSBmdW5jdGlvbiBjYjogZm9uY3Rpb24gZGUgcmVjdXBlcmF0aW9uIGRlcyBlcnJldXJzIGV0IGRlcyBkb25uZWVzDQogICAgKi8NCg0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZGVsZXRlKCR0YWJsZSwgJGNiID0gbnVsbCwgJHdoZXJlID0gbnVsbCkNCiAgICB7DQoNCiAgICAgICAgZG9FeGNlcHRpb24oJGNiLCAiRXhlY3V0ZXogZW4gcHJlbWllciBjZXR0ZSBjb21tYW5kZSwgRG9vOjppbml0KGRzbiwgY2IpLiAiKTsNCg0KICAgICAgICAkcXVlcnkgPSAiREVMRVRFIEZST00gIiAuICR0YWJsZSAuICIgV0hFUkUiOw0KDQogICAgICAgICRpID0gMDsNCg0KICAgICAgICBpZigkd2hlcmUgPT09IG51bGwpIHsNCg0KICAgICAgICAgICAgc2VsZjo6ZG9FeGNlcHRpb24oJGNiLCAiU3ludGF4ZSBlcnJvciIsIHNlbGY6OkVSUk9SKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgZm9yZWFjaCAoJHdoZXJlIGFzICRrZXkgPT4gJHZhbHVlKSB7DQogICAgICAgICAgICAkcXVlcnkgLj0gKGkgPiAwID8gJyBBTkQnIDogJycpIC4gIiAke2tleX0gPSA6eyRrZXl9IjsNCiAgICAgICAgICAgICRpKys7DQogICAgICAgIH0NCg0KICAgICAgICAkcmVxID0gc2VsZjo6JGJkZC0+cHJlcGFyZSgkcXVlcnkpOw0KDQogICAgICAgIGZvcmVhY2ggKCR3aGVyZSBhcyAka2V5ID0+ICR2YWx1ZSkgew0KICAgICAgICAgICAgJHJlcS0+YmluZFZhbHVlKCJ7JGtleX0iLCAkdmFsdWUsIGlzX3N0cmluZygkdmFsdWUpID8gUERPOjpQQVJBTV9TVFIgOiBQRE86OlBBUkFNX0lOVCk7DQogICAgICAgIH0NCg0KICAgICAgICAkcmVxLT5leGVjdXRlKCk7DQoNCiAgICAgICAgaWYoJGNiICE9PSBudWxsKQ0KICAgICAgICB7DQogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkY2IsIFtzZWxmOjpnZXRFcnJvcihzZWxmOjokYmRkLT5lcnJvckluZm8oKSwgJHF1ZXJ5KV0pOw0KICAgICAgICB9DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAqIHVwbG9hZEZpbGUsIGZvbmN0aW9uIHBlcm1ldHRhbnQgZCd1cGxvYWRlZCB1biBmaWNoaWVyLg0KICAgICoNCiAgICAqIEBwYXJhbSBhcnJheSwgdW4gdGFibGVhdSBjb21wb3J0YW50IGxlcyBpbmZvcmFtdGlvIHN1ciBsZSBmaWNoaWVyIGEgdXBsb2FkZXIgcHJvdmVuYW50IGRlIGxhIHZhcmlhYmxlICRfRklMRVMuDQogICAgKiBAcGFyYW0gYXJyYXksIGxpc3RlIGRlcyBleHRlbnNpb25zIHZhbGlkZXMuDQogICAgKiBAcGFyYW0gc3RyaW5nWyR1cGxvYWRlZERpcmVjdG9yeSA9IG51bGxdLCBjaGVtaW4gZHUgcmVwcmV0b2lyZSBkYW5zIGxlcXVlbGxlIGxlIGZpY2hpZXIgdG9pIGV0cmUgdXBsb2FkZXIuDQogICAgKiBAcGFyYW0gZm9uY3Rpb25bJGNiID0gbnVsbF0sIGZvbmN0aW9uIGRlIHJhcHBlbCBwb3VyIHJlY3VwZXJlciBsZXMgZXJyZXVycy4NCiAgICAqLw0KDQogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiB1cGxvYWRGaWxlKCRmaWxlLCBhcnJheSAkZXh0ZW5zaW9uLCAkY2IgPSBudWxsLCAkaGFzaCA9IG51bGwpDQogICAgew0KICAgICAgICAkZmlsZSA9IChvYmplY3QpICRmaWxlOw0KICAgICAgICBpZihpc19hcnJheSgkZXh0ZW5zaW9uKSkNCiAgICAgICAgew0KDQogICAgICAgICAgICAkZXh0ZW5zaW9uVmFsaWRlID0gJGV4dGVuc2lvbjsNCg0KICAgICAgICB9DQogICAgICAgIGVsc2UNCiAgICAgICAgew0KDQogICAgICAgICAgICAkY2IgPSAkZXh0ZW5zaW9uOw0KDQogICAgICAgIH0NCg0KICAgICAgICAjIFNpIGxlIGZpY2hpZXIgZXN0IGJpZW4gZGFucyBsZSByZXBlcnRvaXIgdG1wIGRlIFBIUA0KICAgICAgICBpZihpc191cGxvYWRlZF9maWxlKCRmaWxlLT50bXBfbmFtZSkpDQogICAgICAgIHsNCg0KICAgICAgICAgICAgaWYoIWlzX2RpcihzZWxmOjokdXBsb2FkRGlyKSkNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgIG1rZGlyKHNlbGY6OiR1cGxvYWREaXIsIDA3NzcpOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICMgU2kgbGUgZmljaGllciBlc3QgYmllbiB1cGxvYWRlciwgYXZlYyBhdWN1bmUgZXJyb3INCiAgICAgICAgICAgIGlmKCRmaWxlLT5lcnJvciA9PT0gMCkNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgIGlmKCRmaWxlLT5zaXplIDw9IHNlbGY6OiRmaWxlU2l6ZSkNCiAgICAgICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICAgICAgJHBhdGhJbmZvID0gKG9iamVjdCkgcGF0aGluZm8oJGZpbGUtPm5hbWUpOw0KDQogICAgICAgICAgICAgICAgICAgIGlmKGluX2FycmF5KCRwYXRoSW5mby0+ZXh0ZW5zaW9uLCAkZXh0ZW5zaW9uVmFsaWRlKSkNCiAgICAgICAgICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZigkaGFzaCAhPT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaWxlbmFtZSA9IGhhc2goJGhhc2gsIHVuaXFpZChyYW5kKG51bGwsIHRydWUpKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmlsZW5hbWUgPSAkcGF0aEluZm8tPmZpbGVuYW1lOw0KDQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICRleHQgPSAkcGF0aEluZm8tPmV4dGVuc2lvbjsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgbW92ZV91cGxvYWRlZF9maWxlKCRmaWxlLT50bXBfbmFtZSwgc2VsZjo6JHVwbG9hZERpciAuICIvIiAuICRmaWxlbmFtZSAuICcuJyAuICRleHQpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAjIFN0YXR1cywgZmljaGllciB1cGxvYWTDqQ0KICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyA9IFsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3RhdHVzIiA9PiBzZWxmOjpTVUNDRVNTLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIiA9PiBzZWxmOjpzdXJyb3VuZCgnRmlsZSBVcGxvYWRlZC4nLCAnIzZERDM3QycpDQogICAgICAgICAgICAgICAgICAgICAgICBdOw0KDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICMgU3RhdHVzLCBleHRlbnNpb24gZHUgZmljaGllcg0KICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyA9IFsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBzZWxmOjpFUlJPUiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gc2VsZjo6c3Vycm91bmQoJ0F2YWlsYWJlIEZpbGUsIHZlcmlmeSBmaWxlIHR5cGUuJywgc2VsZjo6RVJST1IpDQogICAgICAgICAgICAgICAgICAgICAgICBdOw0KDQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgICAgICMgU3RhdHVzLCBsYSB0YWlsbGUgZXN0IGludmFsaWRlDQogICAgICAgICAgICAgICAgICAgICRzdGF0dXMgPSBbDQogICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBzZWxmOjpFUlJPUiwNCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiBzZWxmOjpzdXJyb3VuZCgnRmlsZSBpcyBtb3JlIGJpZywgbWF4IHNpemUgJyAuIHNlbGY6OiRmaWxlU2l6ZS4gJyBvY3RldHMuJywgc2VsZjo6RVJST1IpDQogICAgICAgICAgICAgICAgICAgIF07DQoNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgICMgU3RhdHVzLCBmaWNoaWVyIGVycm9uw6kuDQogICAgICAgICAgICAgICAgJHN0YXR1cyA9IFsNCiAgICAgICAgICAgICAgICAgICAgInN0YXR1cyIgPT4gc2VsZjo6RVJST1IsDQogICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIiA9PiBzZWxmOjpzdXJyb3VuZCgnTGUgZmljaGllciBwb3Nzw6hkZSBkZXMgZXJyZXVycy4nLCBzZWxmOjpFUlJPUikNCiAgICAgICAgICAgICAgICBdOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KICAgICAgICBlbHNlDQogICAgICAgIHsNCg0KICAgICAgICAgICAgIyBTdGF0dXMsIGZpY2hpZXIgbm9uIHVwbG9hZMOpDQogICAgICAgICAgICAkc3RhdHVzID0gWw0KICAgICAgICAgICAgICAgICJzdGF0dXMiID0+IHNlbGY6OkVSUk9SLA0KICAgICAgICAgICAgICAgICJtZXNzYWdlIiA9PiBzZWxmOjpzdXJvdW5kKCcgOiBMZSBmaWNoaWVyIG5cJ2EgcGFzIHB1cyDDqnRyZSB1cGxvYWRlci4nLCBzZWxmOjpFUlJPUikNCiAgICAgICAgICAgIF07DQoNCiAgICAgICAgfQ0KDQogICAgICAgIGlmKCRjYiAhPT0gbnVsbCkNCiAgICAgICAgew0KDQogICAgICAgICAgICBjYWxsX3VzZXJfZnVuY19hcnJheSgkY2IsIFsob2JqZWN0KSAkc3RhdHVzLCBpc3NldCgkZmlsZW5hbWUpID8gJGZpbGVuYW1lIDogbnVsbCwgaXNzZXQoJGV4dCkgPyAkZXh0IDogbnVsbF0pOw0KDQogICAgICAgIH0NCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICogc2V0VXBsb2FkZWREaXIsIGZvbmN0aW9uIHBlcm1ldHRhbnQgZGUgcmVkZWZpbmlyIGxlIHJlcGVydG9pciBkJ3VwbG9hZA0KICAgICogQHBhcmFtIHN0cmluZzpwYXRoLCBsZSBjaGVtaW4gZHUgZG9zc2llciBkZSBsJ3VwbG9hZA0KICAgICovDQogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBzZXRVcGxvYWRlZERpcigkcGF0aCkNCiAgICB7DQoNCiAgICAgICAgaWYoaXNfc3RyaW5nKCRwYXRoKSkgew0KDQogICAgICAgICAgICBzZWxmOjokdXBsb2FkRGlyID0gJHBhdGg7DQoNCiAgICAgICAgfSBlbHNlIHsNCg0KICAgICAgICAgICAgc2VsZjo6ZG9FeGNlcHRpb24obnVsbCwgIlNWUCwgdW5lIGNoYWluZSBkZSBjYXJhY3RlciBlc3QgZGVtYW5kZXIuIik7DQogICAgICAgICAgICBleGl0KCk7DQoNCiAgICAgICAgfQ0KDQogICAgfQ0KDQogICAgLyoqDQogICAgKiBnZXRFcnJvciBlc3QgdW5lIGZvbmN0aW9uIHBlcm1ldGFudCBkZSBmb3JtYXRlciBkZXMgZXJyZXVycywgZXQgbm91cyBsZXMgZW52b3llcw0KICAgICoNCiAgICAqIEBwYXJhbSBhcnJheSwgbGlzdGUgZGVzIGVycmV1cnMgZ2VuZXJlciBwYXMgUERPRXhjZXB0aW9uDQogICAgKiBAcGFyYW0gc3RyaW5nLCBsYSByZXF1ZXRlIHN1ciBsYXF1ZWxsZSBpbCB5IGEgZXUgbCdlcnJldXINCiAgICAqIEByZXR1cm4gb2JqZWN0LCB1biBvYmpldCBjb250ZW5hbnQgbGVzIGluZm9ybWF0aW9ucyBmb3JtYXRlcyBkZSBsJ2VycmV1cg0KICAgICovDQogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gZ2V0RXJyb3IoJGVyciwgJHF1ZXJ5KQ0KICAgIHsNCg0KICAgICAgICAkb3JpZ24gPSBwcmVnX3JlcGxhY2UoIiMnW2EtekEtWl8tXStcLiMiLCAiIiwgJGVyclsyXSk7DQoNCiAgICAgICAgcmV0dXJuIChvYmplY3QpIFsNCiAgICAgICAgICAgICJlcnJvciIgPT4gJGVyclsyXSAhPT0gbnVsbCA/IHRydWU6IGZhbHNlLA0KICAgICAgICAgICAgInF1ZXJ5IiA9PiAkcXVlcnksDQogICAgICAgICAgICAiZXJyb3JJbmZvIiA9PiAkZXJyWzJdICE9PSBudWxsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBzZWxmOjpzdXJyb3VuZChzdHJfcmVwbGFjZSgiJyAiLCAiICIsICRvcmlnbiksIHNlbGY6OkVSUk9SKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogc2VsZjo6U1VDQ0VTUw0KICAgICAgICBdOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgKiBzdXJyb3VuZCwgZm9uY3Rpb24gcGVybWV0dGFudCBkZSBmb3JtYXRlciBlbiBIVE1MIHVuIG1lc3NhZ2UgZCdlcnJvcg0KICAgICoNCiAgICAqIEBwYXJhbSBzdHJpbmcgJG1lc3NhZ2UuDQogICAgKiBAcGFyYW0gaW50LCAkZXJyQ29kZQ0KICAgICogQHJldHVybiBzdHJpbmcgJG1lc3NhZ2UsIGZvcm1hdGVyDQogICAgKi8NCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiBzdXJyb3VuZCgkbWVzc2FnZSwgJGVyckNvZGUgPSBudWxsKQ0KICAgIHsNCg0KICAgICAgICBpZigkZXJyQ29kZSA9PT0gc2VsZjo6RVJST1IpIHsNCg0KICAgICAgICAgICAgJGNvbG9yID0gIiNGRjVCNjAiOw0KDQogICAgICAgIH0gZWxzZSBpZigkZXJyQ29kZSA9PT0gc2VsZjo6U1VDQ0VTUykgew0KDQogICAgICAgICAgICAkY29sb3IgPSAiIzhCRkY4OCI7DQoNCiAgICAgICAgfSBlbHNlIHsNCg0KICAgICAgICAgICAgJGNvbG9yID0gIiNGN0NGNTkiOw0KDQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJzxzcGFuIHN0eWxlPSJmb250LWZhbWlseTogdmVyZGFuYTsgZm9udC1zaXplOiAxNXB4OyBiYWNrZ3JvdW5kLWNvbG9yOicgLiAkY29sb3IgLiAnOyBjb2xvcjogd2hpdGU7IGRpc3BsYXk6IGJsb2NrOyBwYWRkaW5nOiAxMHB4OyBib3JkZXItcmFkaXVzOiA1cHg7Ij4nIC4gJG1lc3NhZ2UgLiAnPC9zcGFuPic7DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAqIHNldEZpbGVTaXplLCBmb25jdGlvbiBwZXJtZXR0YW50IGRlIG1vZGlmZXIgbGEgdGFpbGxlIGRlcyBmaWNoaWVycyBhIHVwbG9hZGVyDQogICAgKg0KICAgICogQHBhcmFtIGludCwgbm91dmVsbGUgdGFpbGxlIGRlcyBmaWNoaWVyIGEgdXBsb2FkZXINCiAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gc2V0RmlsZVNpemUoJGZpbGVTaXplKSB7DQoNCiAgICAgICAgc2VsZjo6JGZpbGVTaXplID0gKGludCkgJGZpbGVTaXplOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogbWFpbCwgZm9uY3Rpb24gcGVybWV0dGFudCBkJ2luaXRpYWxpc2VyIGxhIGZvbmN0aW9ubmFsaXTDqSBlbnZveWUtbWFpbCBkdSBzeXN0ZW1lDQogICAgICoNCiAgICAgKiBAcmV0dXJuIFxEb29cRG9vTWFpbGkNCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG1haWwoKSB7DQoNCiAgICAgICAgaWYoc2VsZiRtYWlsID09PSBudWxsKSB7DQoNCiAgICAgICAgICAgIHNlbGY6OiRtYWlsIG5ldyBEb29tYWlsKCk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBzZWxmOjokbWFpbDsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIGRhdGUsIGZvbmN0aW9uIGRlIHJlY3VwZXJhdGlvbiBkZSBsYSBkYXRlDQogICAgICoNCiAgICAgKiBAcGFyYW0gbnVsbCAkY2ZnDQogICAgICogQHJldHVybiBcRG9vXERvb0RhdGVNYWtlcg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZGF0ZSgkdGltZXN0YW5wID0gbnVsbCkgew0KDQogICAgICAgIGlmKCR0aW1lc3RhbnAgIT09IG51bGwpIHsNCg0KICAgICAgICAgICAgcmV0dXJuIG5ldyBEb29kYXRlTWFrZXIoJHRpbWVzdGFucCk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBuZXcgRG9vZGF0ZU1ha2VyKCk7DQoNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiBkb0V4Y2VwdGlvbigkY2IgPSBudWxsLCAkbWVzc2FnZSkgew0KDQogICAgICAgIGlmKHNlbGY6OiRiZGQgPT09IG51bGwpIHsNCg0KICAgICAgICAgICAgJGVyciA9IG5ldyBcRXhjZXB0aW9uKHNlbGY6OnN1cnJvdW5kKCRtZXNzYWdlLCBpc3NldChmdW5jX2dldF9hcmdzKClbMl0pID8gZnVuY19nZXRfYXJncygpWzJdIDogc2VsZjo6RVJST1IpKTsNCg0KICAgICAgICAgICAgaWYoJGNiICE9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jX2FycmF5KCRjYiwgWyRlcnIsIG51bGxdKTsNCiAgICAgICAgICAgICAgICBkaWUoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdGhyb3cgJGVycjsNCiAgICAgICAgfQ0KDQogICAgfQ0KDQp9DQp0DQo=
EOPAGE;

$data['doodb'] = <<< EOPGAE
PD9waHANCg0KLyoqDQoqIFBIUCwgdW5lIGNsYXNzZSBQSFAgc2ltcGxlLiBEYW5zIGxlIGJ1dCBzaW1wbGlmacOpIGwndXRpbGlzYXRpb24gZGUgUERPDQoqIEBhdXRob3IgRGFraWEgRnJhbmNrIDxkYWtpYWZyYW5ja2luZm9AZ21haWwuY29tPg0KKiBAcGFja2FnZSBEb287DQoqIEB2ZXJzaW9uIDAuMS4wDQoqLw0KbmFtZXNwYWNlIERvbzsNCg0KYWJzdHJhY3QgY2xhc3MgRG9vZGIgew0KDQogICAgLyoqDQogICAgICogQHBhcmFtIG51bGwgJGRzbg0KICAgICAqIEBwYXJhbSBudWxsICRjYg0KICAgICAqIEByZXR1cm4gbnVsbHxcUERPDQogICAgICogQHRocm93cyBcRXhjZXB0aW9uDQogICAgICovDQogICAgcHJvdGVjdCBzdGF0aWMgZnVuY3Rpb24gY29ubmVjdGlvbigkZHNuID0gbnVsbCwgJGNiID0gbnVsbCl7DQoNCiAgICAgICAgaWYoJGRzbiAhPT0gbnVsbCkNCiAgICAgICAgew0KDQogICAgICAgICAgICBpZighaXNfc3RyaW5nKCRkc24pKQ0KICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgJGNiID0gJGRzbjsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYoJGRzbiA9PT0gbnVsbCkNCiAgICAgICAgew0KICAgICAgICAgICAgJHN0cmVhbSA9IEBmaWxlX2dldF9jb250ZW50cygiLi4vLmNvbmZpZy8uZHNuIik7DQoNCiAgICAgICAgICAgIGlmKCEkc3RyZWFtKQ0KICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgaWYgKCRjYiAhPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmMoJGNiLCBuZXcgXEV4Y2VwdGlvbigiVsOpcmlmaWV6IGxlIGNoZW1pbiBkZSBmaWNoaWVyIGFwcC5jb25mIHNpdHVlciBkYW5zIGFwcGNvbmZpZyIpKTsNCg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBcRXhjZXB0aW9uKCJWw6lyaWZpZXogbGUgY2hlbWluIGRlIGZpY2hpZXIgYXBwLmNvbmYgc2l0dWVyIGRhbnMgYXBwY29uZmlnIik7DQoNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGRzbiA9IHByZWdfcmVwbGFjZSgiI15bQS1aXSs9fFxuIyIsICIiLCBiYXNlNjRfZGVjb2RlKCRzdHJlYW1bMF0pKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgJHRtcCA9IGV4cGxvZGUoIi8iLCAkZHNuKTsNCg0KICAgICAgICAkY29uZmlnID0gQGV4cGxvZGUoIkAiLCAkdG1wWzJdKTsNCiAgICAgICAgJHVzZXJDb25maWcgPSBAZXhwbG9kZSgiOiIsICRjb25maWdbMF0pOw0KICAgICAgICAkaG9zdENvbmZpZyA9IEBleHBsb2RlKCI6IiwgJGNvbmZpZ1sxXSk7DQoNCiAgICAgICAgJGhvc3QgPSBAJGhvc3RDb25maWdbMF07DQogICAgICAgICRwb3J0ID0gaXNzZXQoJGhvc3RDb25maWdbMV0pID8gQCRob3N0Q29uZmlnWzFdIDogJyc7DQoNCiAgICAgICAgJHVzZXIgPSBAJHVzZXJDb25maWdbMF07DQogICAgICAgICRwYXNzd29yZCA9IGlzc2V0KCR1c2VyQ29uZmlnWzFdKSA/IEAkdXNlckNvbmZpZ1sxXSA6ICcnOw0KDQogICAgICAgICRkYm5hbWUgPSBAJHRtcFszXTsNCiAgICAgICAgJGVuZ2luZSA9IEAkdG1wWzBdOw0KDQogICAgICAgIHRyeXsNCg0KICAgICAgICAgICAgIyBJbnN0YW50aWF0aW9uIGRlIGxhIGNvbm5lY3Rpb24gdmlhIGxlIGRyaXZlciBQRE8NCiAgICAgICAgICAgICRiZGQgPSBuZXcgXFBETygiJHtlbmdpbmV9Omhvc3Q9JHtob3N0fTtkYm5hbWU9JHtkYm5hbWV9IiwgIiR7dXNlcn0iLCAiJHtwYXNzd29yZH0iKTsNCg0KICAgICAgICB9Y2F0Y2goXEV4Y2VwdGlvbiAkZSl7DQogICAgICAgICAgICAjIGdlc3Rpb24gZCdleGNlcHRpb24gc3VyIGxhIGNoYWluZSBkZSBjb25uZWN0aW9uIFBETw0KDQogICAgICAgICAgICBpZigkY2IgIT09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgIyBpcyBlbGxlIG4nZXN0IHBhcyBudWxsLCBleGVjdXRpb24gZGUgbGEgZm9uY3Rpb24gZGUgcmFwcGVsDQogICAgICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmMoJGNiLCAkZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KDQogICAgICAgIH0NCg0KICAgICAgICBpZigkY2IgIT09IG51bGwpDQogICAgICAgIHsNCiAgICAgICAgICAgICMgaXMgZWxsZSBuJ2VzdCBwYXMgbnVsbCwgZXhlY3V0aW9uIGRlIGxhIGZvbmN0aW9uIGRlIHJhcHBlbA0KICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmMoJGNiLCBudWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgICMgUmV0b3VyIGRlIGwnb2JqZXQgUERPDQogICAgICAgIHJldHVybiAkYmRkOw0KDQogICAgfQ0KDQp9DQo=
EOPGAE;

$data['doodata'] = <<< EOPAGE
PD9waHANCg0KLyoqDQoqIFBIUCwgdW5lIGNsYXNzZSBQSFAgc2ltcGxlLiBEYW5zIGxlIGJ1dCBzaW1wbGlmacOpIGwndXRpbGlzYXRpb24gZGUgUERPDQoqIEBhdXRob3IgRGFraWEgRnJhbmNrIDxkYWtpYWZyYW5ja2luZm9AZ21haWwuY29tPg0KKiBAcGFja2FnZSBEb287DQoqIEB2ZXJzaW9uIDAuMS4wDQoqLw0KDQpuYW1lc3BhY2UgRG9vOw0KDQovKioNCiogRG9vZGF0YSwgY2xhc3MgRG9vIHBlcm1ldHRhbnQgZGUgY3J5cHRlciBldCBkZWNyaXB0ZXIgZGUgZG9ubmVlDQoqLw0KYWJzdHJhY3QgY2xhc3MgRG9vZGF0YSBleHRlbmRzIERvb2RiIHsNCg0KCXByaXZhdGUgc3RhdGljICRwYXJ0ID0gIlwwXDBcMFwwXDBcMFwwXDBcMFwwXDBcMFwwXDBcMFwwIjsNCglwdWJsaWMgc3RhdGljICRtb2RlID0gTUNSWVBUX01PREVfQ0JDOw0KCXB1YmxpYyBzdGF0aWMgJGtleSA9ICdlMTA0ODFkZGQwMmFjZjM2NmY1N2M2MDgxOTg3N2EzMic7DQoJcHJpdmF0ZSBzdGF0aWMgJGRhdGFMZW4gID0gbnVsbDsNCg0KCS8qKg0KCSogZGVjcnlwdG8sIGZvbmN0aW9uIHBlcm1ldHRhbnQgZGUgZGVjcnlwdGVyIHVuZSBjaGFpbmUgZGUgY2FyYWN0ZXJlIGVuY3J5cHRlciBhdmVjIGxhIGZvbmN0aW9uIHNvZXVyLg0KICAgICoNCgkqIEBwYXJhbSBzdHJpbmcsIGRvbm5lZSBhIGRlY3J5cHRlci4NCgkqIEBwYXJhbSBmdW5jdGlvbiwgdW5lIGZvbmN0aW9uIGRlIGNhbGxiYWNrLg0KCSogQHJldHVybiBzdHJpbmcsIHJlc3VsdGF0DQoJKi8NCg0KCXByb3RlY3Qgc3RhdGljIGZ1bmN0aW9uIGRlY3J5cHRvKCRkYXRhLCAkY2IgPSBudWxsKQ0KCXsNCg0KCQkkZGVjb2RlID0gYmFzZTY0X2RlY29kZSgkZGF0YSk7DQoJCSRyID0gbWNyeXB0X2RlY3J5cHQoTUNSWVBUX1JJSk5EQUVMXzEyOCwgc2VsZjo6JGtleSwgJGRlY29kZSwgc2VsZjo6JG1vZGUsIHNlbGY6OiRwYXJ0KTsNCg0KCQlpZigkY2IgIT09IG51bGwpDQoJCXsNCgkJCWNhbGxfdXNlcl9mdW5jKCRjYiwgKHN1YnN0cigkciwgMCwgc2VsZjo6JGRhdGFMZW4pKSk7DQoJCX0NCg0KCQlyZXR1cm4gJHI7DQoNCgl9DQoNCg0KCS8qKg0KCSogY3J5cHRvLCBmb25jdGlvbiBwZXJtZXR0YW50IGQnZW5jcnlwdGVyIHVuZSBjaGFpbmUgZGUgY2FyYWN0ZXJlLg0KICAgICoNCgkqIEBwYXJhbSBzdHJpbmcsIGRvbm5lZSBhIGVuY3J5cHRlci4NCgkqIEBwYXJhbSBmdW5jdGlvbiwgdW5lIGZvbmN0aW9uIGRlIGNhbGxiYWNrLg0KCSogQHJldHVybiBzdHJpbmcsIHJlc3VsdGF0DQoJKi8NCglwcm90ZWN0IHN0YXRpYyBmdW5jdGlvbiBjcnlwdG8oJGRhdGEsICRjYiA9IG51bGwpDQoJew0KDQoJCSMgT24gcmVjdXBlcmUgbGEgdGFpbGxlIGRlIGxhIGRvbm5lZS4NCgkJc2VsZjo6JGRhdGFMZW4gPSBzdHJsZW4oJGRhdGEpOw0KCQkkciA9IGJhc2U2NF9lbmNvZGUobWNyeXB0X2VuY3J5cHQoTUNSWVBUX1JJSk5EQUVMXzEyOCwgc2VsZjo6JGtleSwgJGRhdGEsIHNlbGY6OiRtb2RlLCBzZWxmOjokcGFydCkpOw0KDQoJCWlmKCRjYiAhPT0gbnVsbCkNCgkJew0KCQkJY2FsbF91c2VyX2Z1bmMoJGNiLCAkcik7DQoJCX0NCg0KCQlyZXR1cm4gJHI7DQoNCgl9DQoNCn0NCg==
EOPAGE;

$data['doomail'] = <<< EOPAGE
PD9waHANCg0KLyoqDQoqIFBIUCwgdW5lIGNsYXNzZSBQSFAgc2ltcGxlLiBEYW5zIGxlIGJ1dCBzaW1wbGlmacOpIGwndXRpbGlzYXRpb24gZGUgUERPDQoqIEBhdXRob3IgRGFraWEgRnJhbmNrIDxkYWtpYWZyYW5ja2luZm9AZ21haWwuY29tPg0KKiBAcGFja2FnZSBEb287DQoqIEB2ZXJzaW9uIDAuMS4wDQoqLw0KDQpuYW1lc3BhY2UgRG9vOw0KDQovKioNCiogRG9vTWFpbCwgY2xhc3NlIHBlcm1ldHRhbnQgZCdlbnZveWVyIGRlcyBtYWlscw0KKi8NCmNsYXNzIERvb21haWwgew0KDQogICAgLyoqDQogICAgICoNCiAgICAgKi8NCiAgICBjb25zdCBIRUxQID0gIjxwcmU+Ww0KICAgICAgICA8c3BhbiBzdHlsZT1cImNvbG9yOiAjNDc4XCI+J3RvJzwvc3Bhbj4gPT4gPHNwYW4gc3R5bGU9XCJjb2xvcjogIzU3OFwiPnRvQG1haWxkb21haW4uY29tPC9zcGFuPiwNCiAgICAgICAgPHNwYW4gc3R5bGU9XCJjb2xvcjogIzQ3OFwiPidzdWJqZWN0Jzwvc3Bhbj4gPT4gPHNwYW4gc3R5bGU9XCJjb2xvcjogIzU3OFwiPnlvdSBzdWJqZWN0PC9zcGFuPiwNCiAgICAgICAgPHNwYW4gc3R5bGU9XCJjb2xvcjogIzQ3OFwiPidkYXRhJzwvc3Bhbj4gPT4gPHNwYW4gc3R5bGU9XCJjb2xvcjogIzU3OFwiPnlvdXIgZGF0YTwvc3Bhbj4NCiAgICBdPC9wcmU+IjsNCg0KICAgIC8qKg0KICAgICAqIEB2YXIgbnVsbA0KICAgICAqLw0KICAgIHByaXZhdGUgJHRvID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBAdmFyIG51bGwNCiAgICAgKi8NCiAgICBwcml2YXRlICRmcm9tID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBAdmFyIG51bGwNCiAgICAgKi8NCiAgICBwcml2YXRlICRzdWJqZWN0ID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBAdmFyIG51bGwNCiAgICAgKi8NCiAgICBwcml2YXRlICRkYXRhID0gbnVsbDsNCg0KICAgIC8qKg0KICAgICAqIEB2YXIgYXJyYXkNCiAgICAgKi8NCiAgICBwcml2YXRlICRhZGRpdGlvbm5hbEhlYWRlciA9IFtdOw0KDQogICAgLyoqDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwcml2YXRlICRoZWFkZXJzOw0KDQogICAgLyoqDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwcml2YXRlICRjaGFyc2V0ID0gJ2lzby04ODk2LTEnOw0KICAgIC8qKg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHJpdmF0ZSAkYm91bmRhcnlIYXNoOw0KDQogICAgLyoqDQogICAgICogQHZhciBhcnJheQ0KICAgICAqLw0KICAgIHByaXZhdGUgJGF0dGFjaGVtZW50RmlsZTsNCg0KICAgIC8qKg0KICAgICAqIEB2YXIgc3RyaW5nDQogICAgICovDQogICAgcHJpdmF0ZSAkdHlwZU1pbWU7DQoNCiAgICAvKioNCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqLw0KICAgIHByaXZhdGUgJHRleHQ7DQoNCiAgICAvKioNCiAgICAgKiBAdmFyIHN0cmluZw0KICAgICAqLw0KICAgIHByaXZhdGUgJGh0bWw7DQoNCiAgICBmdW5jdGlvbiBfX2NvbnN0cnVjdCgpIHsNCg0KICAgICAgICAkdGhpcy0+Ym91bmRhcnlIYXNoID0gbWQ1KGRhdGUoInIiLCB0aW1lKCkpKTsNCiAgICAgICAgJHRoaXMtPnR5cGVNaW1lID0gInRleHQvcGxhaW4iOw0KICAgICAgICAkdGhpcy0+ZnJvbSA9IGluaV9nZXQoInNtcHRfZnJvbSIpOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogc2V0VHlwZU1pbWUsIGZvbmN0aW9uIGRlIHJlZGVmaW5pciBsZSB0eXBlIG1pbWUgZHUgbWVzc2FnZSBhIGVudm95ZQ0KICAgICAqDQogICAgICogQHBhcmFtIHN0cmluZyAkbWltZQ0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRUeXBlTWltZSgkbWltZSkgew0KDQogICAgICAgICR0aGlzLT50eXBlTWltZSA9ICRtaW1lOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgKiBmcm9tLCBmb25jdGlvbiBwZXJtZXR0YW50IGRlIGRlZmluaXIgbCdlbnZveWV1ciBkZSBtYWlsDQogICAgKg0KICAgICogQHBhcmFtIHN0cmluZyAkZnJvbQ0KICAgICogQHBhcmFtIERvb01haWxpLCBPYmplY3QgRG9vTWFpbGkNCiAgICAqIEByZXR1cm4gJHRoaXMNCiAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBmcm9tKCRmcm9tKSB7DQoNCiAgICAgICAgaWYgKGlzX3N0cmluZygkZnJvbSkpIHsNCg0KICAgICAgICAgICAgJHRoaXMtPmZyb20gPSAkZnJvbTsNCg0KICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgICAgICBzZWxmOjplcnJubygiRnJvbTogPHZvdHJlIGFkcmVzcz5APGRvbWFpbj4uPGNvbT4iKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICR0aGlzOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgKiB0bywgZm9uY3Rpb24gcGVybWV0YW50IGRlIGRlZmluaXIgbGUgZGVzdGluYXRldXIgZGUgbWFpbA0KICAgICoNCiAgICAqIEBwYXJhbSBzdHJpbmcgJHRvDQogICAgKiBAcmV0dXJuIERvb01haWxpLCBPYmplY3QgRG9vTWFpbGkNCiAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiB0bygkdG8pIHsNCg0KICAgICAgICBpZiAoaXNfc3RyaW5nKCR0bykpIHsNCg0KICAgICAgICAgICAgJHRoaXMtPiR0byA9ICR0bzsNCg0KICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgICAgICBzZWxmOjplcnJubygiRXhjZXB0ZWQgcGFyYW1ldGVyIHN0cmluZy4iKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICR0aGlzOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgKiBzdWJqZWN0LCBmb25jdGlvbiBwZXJtZXRhbnQgZGUgZGVmaW5pciBsZSBzdWpldCBkdSBtYWlsDQogICAgKg0KICAgICogQHBhcmFtIHN0cmluZyAkc3ViDQogICAgKiBAcmV0dXJuIERvb01haWxpLCBPYmplY3QgRG9vTWFpbGkNCiAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBzdWJqZWN0KCRzdWIpIHsNCg0KICAgICAgICBpZiAoaXNfc3RyaW5nKCRzdWIpKSB7DQoNCiAgICAgICAgICAgICR0aGlzLT5zdWJqZWN0ID0gJHN1YjsNCg0KICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgICAgICBzZWxmOjplcnJubygiRXhjZXB0ZWQgcGFyYW1ldGVyIHN0cmluZy4iKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICR0aGlzOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgKiBkYXRhLCBmb25jdGlvbiBwZXJtZXR0YW50IGRlIGRlZmluaXIgbGUgbWVzc2FnZSBhIGVudm95ZXINCiAgICAqDQogICAgKiBAcGFyYW0gc3RyaW5nICRtc2cNCiAgICAqIEByZXR1cm4gRG9vTWFpbGksIE9iamVjdCBEb29NYWlsaQ0KICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGRhdGEoJG1zZykgew0KDQogICAgICAgIGlmIChpc19zdHJpbmcoJG1zZykpIHsNCg0KICAgICAgICAgICAgJHRoaXMtPnRleHQgPSAkbXNnOw0KICAgICAgICAgICAgJHRoaXMtPmRhdGFNYWtlcigpOw0KDQogICAgICAgIH0gZWxzZSB7DQoNCiAgICAgICAgICAgIHNlbGY6OmVycm5vKCJFeGNlcHRlZCBwYXJhbWV0ZXIgc3RyaW5nLiIpOw0KDQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJHRoaXM7DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAqIGFkZEhlYWRlciwgZm9uY3Rpb24gcGVybWV0dGFudCBkJ2Fqb3V0ZXIgZGVzIGhlYWRlcnMgc3VwbGVtZW50YWlyZS4NCiAgICAqDQogICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lLCBsZSBub20gZHUgbm91dmVhdSBoZWFkZXINCiAgICAqIEBwYXJhbSBzdHJpbmcgJHZhbHVlLCBsYSB2YWxldXIgZGUgbm9tIGVudGVyDQogICAgKiBAcmV0dXJuIERvb01haWxpICR0aGlzDQogICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkSGVhZGVyKCRuYW1lLCAkdmFsdWUpIHsNCg0KICAgICAgICAkdGhpcy0+YWRkaXRpb25uYWxIZWFkZXJbXSA9ICJ7JG5hbWV9OiB7JHZhbHVlfVxyXG4iOw0KICAgICAgICByZXR1cm4gJHRoaXM7DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBhZGRBdHRhY2hlbWVudEZpbGUsIGZvbmN0aW9uIHBlcm1ldHRhbnQgZCdham91dGVyIHVuZSBmaWNoaWVyDQogICAgICoNCiAgICAgKiBAcGFyYW0gc3RyaW5nICRmaWxlDQogICAgICogQHJldHVybiAkdGhpcw0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRBdHRhY2hlbWVudEZpbGUoJGZpbGUpIHsNCg0KICAgICAgICBpZiAoaXNfc3RyaW5nKCRmaWxlKSkgew0KDQogICAgICAgICAgICAkdGhpcy0+YXR0YWNoZW1lbnRGaWxlW10gPSAkZmlsZTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICR0aGlzOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogc2V0RGVmYXVsdEhlYWRlcnMsIGZvbmN0aW9uIHBlcm1ldHRhbnQgZGUgZGVmaW5pciBsZXMgaGVhZGVycyBwYXIgZGVmYXV0DQogICAgICovDQogICAgcHJpdmF0ZSBmdW5jdGlvbiBzZXREZWZhdWx0SGVhZGVycygpIHsNCg0KICAgICAgICAkdGhpcy0+YWRkaXRpb25uYWxIZWFkZXJbXSA9ICdNSU1FLVZlcnNpb246IDEuMCc7DQogICAgICAgICR0aGlzLT5hZGRpdGlvbm5hbEhlYWRlcltdID0gIkZyb206IHskdGhpcy0+ZnJvbX0iOw0KICAgICAgICAkdGhpcy0+YWRkaXRpb25uYWxIZWFkZXJbXSA9ICJUbzogeyR0aGlzLT50b30iOw0KICAgICAgICAkdGhpcy0+YWRkaXRpb25uYWxIZWFkZXJbXSA9ICJTdWJqZWN0OiB7JHRoaXMtPnN1YmplY3R9IjsNCg0KICAgICAgICAjIFdlJ2xsIGFzc3VtZSBhIG11bHRpLXBhcnQgbWVzc2FnZSBzbyB0aGF0IHdlIGNhbiBpbmNsdWRlIGFuIEhUTUwgYW5kIGEgdGV4dCB2ZXJzaW9uIG9mIHRoZSBlbWFpbCBhdCB0aGUNCiAgICAgICAgIyB2ZXJ5IGxlYXN0LiBJZiB0aGVyZSBhcmUgYXR0YWNobWVudHMsIHdlJ2xsIGJlIGRvaW5nIHRoZSBzYW1lIHRoaW5nLg0KICAgICAgICAkdGhpcy0+YWRkaXRpb25uYWxIZWFkZXJbXSA9ICJDb250ZW50LXR5cGU6IG11bHRpcGFydC9taXhlZDsgYm91bmRhcnk9XCJQSFAtbWl4ZWQteyR0aGlzLT5ib3VuZGFyeUhhc2h9XCIiOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogdGV4dCwgZm9uY3Rpb24gcGVybWV0dGFudCBkZSBjb25maWd1cmVyIGxlcyBoZWFkZXJzIHBvdXIgbGVzIHRleHQvcGxhaW4NCiAgICAgKi8NCiAgICBwcml2YXRlIGZ1bmN0aW9uIGRhdGFNYWtlcigpIHsNCg0KICAgICAgICAkdGhpcy0+ZGF0YSAuPSAiLS1QSFAtYWx0LXskdGhpcy0+Ym91bmRhcnlIYXNofVxuIjsNCiAgICAgICAgJHRoaXMtPmRhdGEgLj0gIkNvbnRlbnQtVHlwZTogeyR0aGlzLT50eXBlTWltZX07IGNoYXJzZXQ9XCJ7JHRoaXMtPmNoYXJzZXR9XCJcbiI7DQogICAgICAgICR0aGlzLT5kYXRhIC49ICJDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiA3Yml0XG5cbiI7DQogICAgICAgICR0aGlzLT5kYXRhIC49ICR0aGlzLT50ZXh0LiJcblxuIjsNCg0KICAgIH0NCiAgICAvKioNCiAgICAqIHNlbmQsIGZvbmN0aW9uIGRlIGRlY2xhbmNoZW1lbnQgZGUgbCdlbnZvaWUgZGUgbWFpbA0KICAgICoNCiAgICAqIEBwYXJhbSBjYWxsYWJsZSAkY2IsIGZvbmN0aW9uIGRlIHJhcHBlbCBwb3VyIHJlY3VwZXJlciBsJ2V0YXQgYXByZXMgZW52b2llIGRlIG1haWwNCiAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kKCRjYiA9IG51bGwpIHsNCg0KICAgICAgICBpZiAoY291bnQoJHRoaXMtPmF0dGFjaGVtZW50RmlsZSkgPj0gMSkgew0KDQogICAgICAgICAgICAkdGhpcy0+cHJlcGFyZUF0dGFjaGVtZW50RmlsZSgpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5hZGRpdGlvbm5hbEhlYWRlcikgPiAxKSB7DQoNCiAgICAgICAgICAgICR0aGlzLT5zZXREZWZhdWx0SGVhZGVycygpOw0KICAgICAgICAgICAgJHRoaXMtPmhlYWRlcnMgPSBpbXBsb2RlKFBIUF9FT0wsICR0aGlzLT5hZGRpdGlvbm5hbEhlYWRlcikuUEhQX0VPTDsNCiAgICAgICAgICAgICRzdGF0dXMgPSBAbWFpbCgkdGhpcy0+dG8sICR0aGlzLT5zdWJqZWN0LCAkdGhpcy0+ZGF0YSwgJHRoaXMtPmhlYWRlcnMpOw0KDQogICAgICAgIH0gZWxzZSB7DQoNCiAgICAgICAgICAgICRzdGF0dXMgPSBAbWFpbCgkdGhpcy0+dG8sICR0aGlzLT5zdWJqZWN0LCAkdGhpcy0+ZGF0YSk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKiBAdmFyIGNhbGxhYmxlICRjYiAqLw0KICAgICAgICBpZiAoJGNiICE9PSBudWxsKSB7DQoNCiAgICAgICAgICAgIGlmICghZW1wdHkoJHN0YXR1cykpIHsNCiAgICAgICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkY2IsICRzdGF0dXMpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0NCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICogc2V0TWFpbFNlcnZlciwgZm9uY3Rpb24gcGVybWV0dGFudCBkZSBkZWZpbmlyIGRlIHF1ZWwgc2VydmV1ciBsZSBtYWlsIHNlcmEgZW52b3llcg0KICAgICoNCiAgICAqIEBwYXJhbSBzdHJpbmcgJHNlcnZlck5hbWUsIGxlIG5vbSBkZSBzZXJ2ZXVyLCBvdSBsJ2FkcmVzc2UgSVAgZHUgc2VydmV1cg0KICAgICogQHJldHVybiAkdGhpcw0KICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIHNldE1haWxTZXJ2ZXIoJHNlcnZlck5hbWUpIHsNCg0KICAgICAgICBpZiAoaXNfc3RyaW5nKCRzZXJ2ZXJOYW1lKSkgew0KDQogICAgICAgICAgICBpbmlfc2V0KCdTTVRQJywgJHNlcnZlck5hbWUpOw0KDQogICAgICAgIH0gZWxzZSB7DQoNCiAgICAgICAgICAgIHNlbGY6OmVycm5vKCJFeGNlcHRlZCBwYXJhbWV0ZXIgc3RyaW5nIik7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkdGhpczsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICogc2V0UG9ydCwgZm9uY3Rpb24gcGVybWV0dGFudCBkZSBjb25maWd1cmVyIGxlIHBvcnQgc210cA0KICAgICoNCiAgICAqIEBwYXJhbSBzdHJpbmcgJHBvcnQsIGxlIG51bWVybyBkZSBwb3J0DQogICAgKiBAcmV0dXJuICR0aGlzDQogICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0UG9ydCgkcG9ydCkgew0KDQogICAgICAgIGluaV9zZXQoJ3NtdHBfcG9ydCcsICRwb3J0KTsNCiAgICAgICAgcmV0dXJuICR0aGlzOw0KDQogICAgfQ0KICAgIC8qKg0KICAgICogZXJybm8sIGZvbmN0aW9uIHBlcm1ldHRhbnQgZGVmaW5pciBsZSBtZXNzYWdlIGQnZXJyZXVyLg0KICAgICoNCiAgICAqIEBwYXJhbSBzdHJpbmcsIG1lc3NhZ2UNCiAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIGVycm5vKCRtc2cpIHsNCg0KICAgICAgICB0cmlnZ2VyX2Vycm9yKCRtc2csIEVfV0FSTklORyk7DQogICAgICAgIGV4aXQoKTsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIHByZXBhcmVBdHRhY2hlbWVudCwgZm9uY3Rpb24gcGVybWV0dGFudCBkJ2Fqb3V0ZXIgdW5lIHBpw6hjZS1qb2ludGUNCiAgICAgKi8NCiAgICBwcml2YXRlIGZ1bmN0aW9uIHByZXBhcmVBdHRhY2hlbWVudEZpbGUoKSB7DQoNCiAgICAgICAgZm9yZWFjaCgkdGhpcy0+YXR0YWNoZW1lbnRGaWxlIGFzICRmaWxlKSB7DQoNCiAgICAgICAgICAgICRmaWxlbmFtZSAgPSBiYXNlbmFtZSgkZmlsZSk7DQogICAgICAgICAgICAkdGhpcy0+ZGF0YSAuPSAiLS1QSFAtbWl4ZWQteyR0aGlzLT5ib3VuZGFyeUhhc2h9XG4iOw0KICAgICAgICAgICAgJHRoaXMtPmRhdGEgLj0gIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtOyBuYW1lPVwieyRmaWxlbmFtZX1cIlxuIjsNCiAgICAgICAgICAgICR0aGlzLT5kYXRhIC49ICJDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiBiYXNlNjRcbiI7DQogICAgICAgICAgICAkdGhpcy0+ZGF0YSAuPSAiQ29udGVudC1EaXNwb3NpdGlvbjogYXR0YWNobWVudFxuXG4iOw0KICAgICAgICAgICAgJHRoaXMtPmRhdGEgLj0gY2h1bmtfc3BsaXQoYmFzZTY0X2VuY29kZShmaWxlX2dldF9jb250ZW50cygkZmlsZSkpKTsNCiAgICAgICAgICAgICR0aGlzLT5kYXRhIC49ICJcblxuIjsNCg0KICAgICAgICB9DQoNCiAgICAgICAgJHRoaXMtPmRhdGEgLj0gIi0tUEhQLW1peGVkLXskdGhpcy0+Ym91bmRhcnlIYXNofS0tXG5cbiI7DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBzZXRDaGFyc2V0LCBmb25jdGlvbiBwZXJtZXR0YW50IGRlIHJlZGVmaW5pciBsJ2VuY29kYWdlDQogICAgICogQHBhcmFtIHN0cmluZyAkY2hhcnNldA0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRDaGFyc2V0KCRjaGFyc2V0KSB7DQoNCiAgICAgICAgJHRoaXMtPmNoYXJzZXQgPSAkY2hhcnNldDsNCg0KICAgIH0NCg0KfQ0K
EOPAGE;

$data['doodatemaker'] = <<< EOPAGE
PD9waHANCg0KLyoqDQoqIFBIUCwgdW5lIGNsYXNzZSBQSFAgc2ltcGxlLiBEYW5zIGxlIGJ1dCBzaW1wbGlmacOpIGwndXRpbGlzYXRpb24gZGUgUERPDQoqIEBhdXRob3IgRGFraWEgRnJhbmNrIDxkYWtpYWZyYW5ja2luZm9AZ21haWwuY29tPg0KKiBAcGFja2FnZSBEb287DQoqIEB2ZXJzaW9uIDAuMS4wDQoqLw0KbmFtZXNwYWNlIERvbzsNCg0KLyoqDQoqIERvbyBkYXRlIG1ha2VyDQoqIENyZWF0ZSBkYXRlIDA1LzA1LzIwMTUNCioNCiogQ2xhc3MgRG9vRGF0ZU1ha2VyDQoqDQoqIEBwYWNrYWdlIERvbw0KKi8NCg0KY2xhc3MgRG9vZGF0ZU1ha2VyIHsNCg0KICAgIC8qKg0KICAgICAqIEB2YXINCiAgICAgKi8NCiAgICBwcml2YXRlICR0aW1lc3RhbnA7DQogICAgLyoqDQogICAgICogQHZhciBzdHJpbmcNCiAgICAgKi8NCiAgICBwcml2YXRlICRsb2NhbDsNCg0KICAgIC8qKg0KICAgICAqIEB2YXINCiAgICAgKi8NCiAgICBwcml2YXRlICRzZWNvbmRzOw0KICAgIC8qKg0KICAgICAqIEB2YXINCiAgICAgKi8NCiAgICBwcml2YXRlICRtaW51dGVzOw0KICAgIC8qKg0KICAgICAqIEB2YXINCiAgICAgKi8NCiAgICBwcml2YXRlICRob3VyczsNCg0KICAgIC8qKg0KICAgICAqIEB2YXINCiAgICAgKi8NCiAgICBwcml2YXRlICRkYXlPZlllYXI7DQogICAgLyoqDQogICAgICogQHZhcg0KICAgICAqLw0KICAgIHByaXZhdGUgJGRheU9mV2VlazsNCiAgICAvKioNCiAgICAgKiBAdmFyDQogICAgICovDQogICAgcHJpdmF0ZSAkZGF5T2ZNb250aDsNCiAgICAvKioNCiAgICAgKiBAdmFyDQogICAgICovDQogICAgcHJpdmF0ZSAkbW9udGhPZlllYXI7DQogICAgLyoqDQogICAgICogQHZhcg0KICAgICAqLw0KICAgIHByaXZhdGUgJHllYXI7DQoNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gbnVsbCAkdGltZXN0YW5wDQogICAgICogQHBhcmFtIG51bGwgJGxvY2FsDQogICAgICovDQogICAgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJHRpbWVzdGFucCA9IG51bGwsICRsb2NhbCA9IG51bGwpDQogICAgew0KDQogICAgICAgIGlmKCR0aW1lc3RhbnAgIT09IG51bGwpDQogICAgICAgIHsNCg0KICAgICAgICAgICAgaWYoaXNfc3RyaW5nKCR0aW1lc3RhbnApKQ0KICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgJHRoaXMtPmxvY2FsID0gJHRpbWVzdGFucDsNCiAgICAgICAgICAgICAgICAkdGltZXN0YW5wID0gJHRoaXMtPmxvY2FsICE9PSAiY2lfQ0kiID8gdGltZSgpIDogKHRpbWUoKSAtIDcyMDApOw0KDQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICBpZigkbG9jYWwgIT09IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bG9jYWwgPSAkbG9jYWw7DQogICAgICAgICAgICAgICAgICAgICR0aW1lc3RhbnAgPSAkbG9jYWwgPT09ICJjaV9DSSIgPyAkdGltZXN0YW5wIC0gNzIwMDogJHRpbWVzdGFucDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICB9DQogICAgICAgIGVsc2UNCiAgICAgICAgew0KICAgICAgICAgICAgJHRoaXMtPmxvY2FsID0gImZyX0ZSIjsNCiAgICAgICAgICAgICR0aW1lc3RhbnAgPSB0aW1lKCkgLSA3MjAwOw0KICAgICAgICB9DQoNCiAgICAgICAgJGluaXREYXRlID0gXGdldGRhdGUoJHRpbWVzdGFucCk7DQoNCiAgICAgICAgJHRoaXMtPnNlY29uZHMgPSAkaW5pdERhdGVbJ3NlY29uZHMnXTsNCiAgICAgICAgJHRoaXMtPm1pbnV0ZXMgPSAkaW5pdERhdGVbJ21pbnV0ZXMnXTsNCiAgICAgICAgJHRoaXMtPmhvdXJzID0gJGluaXREYXRlWydob3VycyddOw0KDQogICAgICAgICR0aGlzLT5kYXlPZldlZWsgPSAkaW5pdERhdGVbJ3dkYXknXTsNCiAgICAgICAgJHRoaXMtPmRheU9mWWVhciA9ICRpbml0RGF0ZVsneWRheSddOw0KICAgICAgICAkdGhpcy0+ZGF5T2ZNb250aCA9ICRpbml0RGF0ZVsibWRheSJdOw0KICAgICAgICAkdGhpcy0+eWVhciA9ICRpbml0RGF0ZVsneWVhciddOw0KICAgICAgICAkdGhpcy0+bW9udGhPZlllYXIgPSAkaW5pdERhdGVbJ21vbiddOw0KDQogICAgICAgICR0aGlzLT50aW1lc3RhbnAgPSAkaW5pdERhdGVbMF07DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAqIEBwYXJhbSBzdHJpbmcsIHJlZGVmaW5pciBsYSBsb2NhbA0KICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIHNldExvY2FsKCRsb2NhbCkNCiAgICB7DQoNCiAgICAgICAgaWYoIWlzX3N0cmluZygkbG9jYWwpKQ0KICAgICAgICB7DQogICAgICAgICAgICAkdGhpcy0+bG9jYWwgPSAkbG9jYWw7DQogICAgICAgIH0NCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICogZ2V0RGF5TmFtZSwgZm9uY3Rpb24gcGVybWV0YW50IGRlIHJlY3VwZXJlciBsZSBub20gbGl0dGVyYWwgZHUgam91ci4NCiAgICAqDQogICAgKiBAcGFyYW0gZnVuY3Rpb24sIGZvbmN0aW9uIGRlIHJhcHBlbA0KICAgICogQHJldHVybiBzdHJpbmcNCiAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXREYXlOYW1lKCRjYiA9IG51bGwpDQogICAgew0KICAgICAgICAkZGF5ID0gWw0KDQogICAgICAgICAgICAiZnJfRlIiID0+IFsNCiAgICAgICAgICAgICAgICAiRGltYW5jaGUiLCAiTHVuZGkiLCAiTWFyZGkiLCAiTWVyY3JlZGkiLCAiSmV1ZGkiLCAiVmVuZHJlZGkiLCAiU2FtZWRpIg0KICAgICAgICAgICAgXSwNCg0KICAgICAgICAgICAgImVzX0VTIiA9PiBbDQogICAgICAgICAgICAgICAgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiINCiAgICAgICAgICAgIF0NCg0KICAgICAgICBdOw0KDQogICAgICAgIGlmKCR0aGlzLT5sb2NhbCA9PT0gJ2ZyX0ZSJyB8fCAkdGhpcy0+bG9jYWwgPT09ICdlc19FUycgfHwgJHRoaXMtPmxvY2FsID09PSAnY2lfQ0knKQ0KICAgICAgICB7DQoNCiAgICAgICAgICAgIGlmKCR0aGlzLT5sb2NhbCA9PT0gJ2NpX0NJJykNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgICR0aGlzLT5sb2NhbCA9ICJmcl9GUiI7DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGRheU5hbWUgPSAkZGF5WyR0aGlzLT5sb2NhbF1bJHRoaXMtPmRheU9mV2Vla107DQoNCiAgICAgICAgfQ0KICAgICAgICBlbHNlaWYoJHRoaXMtPmxvY2FsID09PSAnZW5fRU4nKQ0KICAgICAgICB7DQoNCiAgICAgICAgICAgICRkYXlOYW1lID0gXGdldGRhdGUoJHRoaXMtPnRpbWVzdGFucClbIndlZWtkYXkiXTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgaWYoJGNiICE9PSBudWxsKQ0KICAgICAgICB7DQoNCiAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jKCRjYiwgJGRheU5hbWUpOw0KDQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJGRheU5hbWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgKiBnZXREYXlPZk1vbnRoLCBmb25jdGlvbiBwZXJtZXRhbnQgZCdvYnRlbmlyIGxlIG51bWVybyBkdSBqb3VyIGR1IG1vaXMNCiAgICAqIEBwYXJhbSBmdW5jdGlvbiwgZm9uY3Rpb24gZGUgcmFwcGVsIGZhY3VsdGF0aWYNCiAgICAqID09PT09PT09PT09PT09PT09PT0gZS5nID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogICAgKiAkZGF0ZSA9IG5ldyBEb29EYXRlTWFrZXIoKTsNCiAgICAqIGVjaG8gJGRhdGUtPmdldERheU9mTW9udGgoW2Z1bmN0aW9uXSk7DQogICAgKiAvLyBvcg0KICAgICogJGRhdGUtPmdldERheU9mTW9udGgoZnVuY3Rpb24oJGRheU9mTW9udGgpDQogICAgKiB7DQogICAgKiAgIGVjaG8gJGRhdGVPZk1vbnRoOw0KICAgICogfSk7DQogICAgKg0KICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGdldERheU9mTW9udGgoJGNiID0gbnVsbCkNCiAgICB7DQoNCiAgICAgICAgaWYoJGNiICE9PSBudWxsKQ0KICAgICAgICB7DQoNCiAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jKCRjYiwgJHRoaXMtPmRheU9mV2Vlayk7DQoNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkdGhpcy0+ZGF5T2ZXZWVrOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogQHBhcmFtIG51bGwgJGNiDQogICAgICogQHJldHVybiBtaXhlZA0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRZZWFyKCRjYiA9IG51bGwpDQogICAgew0KDQogICAgICAgIGlmKCRjYiAhPT0gbnVsbCkNCiAgICAgICAgew0KDQogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkY2IsICR0aGlzLT55ZWFyKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICR0aGlzLT55ZWFyOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgICogQHBhcmFtIG51bGwgJGNiDQogICAgICogQHJldHVybiBtaXhlZA0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRNb250aE9mWWVhcigkY2IgPSBudWxsKQ0KICAgIHsNCg0KICAgICAgICBpZigkY2IgIT09IG51bGwpDQogICAgICAgIHsNCg0KICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmMoJGNiICwkdGhpcy0+bW9udGhPZlllYXIpOw0KDQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJHRoaXMtPm1vbnRoT2ZZZWFyOw0KDQogICAgfQ0KICAgIC8qKg0KICAgICogZ2V0TW9udGhOYW1lLCBmb25jdGlvbiBwZXJtZXR0YW50IGRlIHJlY3VwZXJlciBsZSBub20gZCd1biBtb2lzDQogICAgKiBAcGFyYW0gZnVuY3Rpb24sIHVuZSBmb25jdGlvbiBkZSByYXBwZWwNCiAgICAqIEByZXR1cm4gc3RyaW5nLCBsZSBub20gZHUgbW9pcw0KICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGdldE1vbnRoTmFtZSgkY2IgPSBudWxsKQ0KICAgIHsNCg0KICAgICAgICAkbW9udGggPSBbDQoNCiAgICAgICAgICAgICJmcl9GUiIgPT4gWw0KICAgICAgICAgICAgICAgICJKYW52aWVyIiwgIkZldnJpZXIiLCAiTWFycyIsDQogICAgICAgICAgICAgICAgIkF2cmlsIiwgIk1haSIsICJKdWluIiwNCiAgICAgICAgICAgICAgICAiSnVpbGxldCIsICJBb3V0IiwgIlNwdGVtYnJlIiwNCiAgICAgICAgICAgICAgICAiT2N0b2JyZSIsICJOb3ZlbWJyZSIsICJEZWNlbWJyZSINCiAgICAgICAgICAgIF0sDQoNCiAgICAgICAgICAgICJlc19FUyIgPT4gWw0KICAgICAgICAgICAgICAgICJMdW5lcyIsICJNYXJ0ZXMiLCAiTWllcmNvbGVzIiwNCiAgICAgICAgICAgICAgICAiTW9udGhBdEVzIiwgIk1vbnRoQXRFcyIsICJNb250aEF0RXMiLA0KICAgICAgICAgICAgICAgICJNb250aEF0RXMiLCAiTW9udGhBdEVzIiwgIk1vbnRoQXRFcyIsDQogICAgICAgICAgICAgICAgIk1vbnRoQXRFcyIsICJNb250aEF0RXMiLCAiTW9udGhBdEVzIg0KICAgICAgICAgICAgICAgIF0NCg0KICAgICAgICBdOw0KDQogICAgICAgIGlmKCR0aGlzLT5sb2NhbCA9PT0gJ2ZyX0ZSJyB8fCAkdGhpcy0+bG9jYWwgPT09ICdlc19FUycgfHwgJHRoaXMtPmxvY2FsID09PSAnY2lfQ0knKQ0KICAgICAgICB7DQoNCiAgICAgICAgICAgIGlmKCR0aGlzLT5sb2NhbCA9PT0gJ2NpX0NJJykNCiAgICAgICAgICAgIHsNCg0KICAgICAgICAgICAgICAgICR0aGlzLT5sb2NhbCA9ICdmcl9GUic7DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJG1vbnRoTmFtZSA9ICRtb250aFskdGhpcy0+bG9jYWxdWyR0aGlzLT5tb250aE9mWWVhciAtIDFdOw0KDQogICAgICAgIH0NCiAgICAgICAgZWxzZWlmKCR0aGlzLT5sb2NhbCA9PT0gJ2VuX0VOJykNCiAgICAgICAgew0KDQogICAgICAgICAgICAkbW9udGhOYW1lID0gZ2V0ZGF0ZSgkdGhpcy0+dGltZXN0YW5wKVsibW9udGgiXTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICRtb250aE5hbWU7DQoNCiAgICB9DQoNCiAgICAvKioNCiAgICAqIGZvcm1hdCwgZm9uY3Rpb24gcGVybWV0dGFudCBkZSBmb3JtYXQgZGVzIGRhdGVzIGVuIGZvbmN0aW9uIGRlcyBiZXNpb24NCiAgICAqIEBwYXJhbSBzdHJpbmcsIGZvcm1hdGFnZSBlLmc6IFktbS1kIEg6bTpzDQogICAgKiBAcGFyYW0gZm9uY3Rpb24sIGZvbmN0aW9uIGRlIHJhcHBlbCBwb3V2YW50IHJlY3VwZXJlciBsZSByZXN1bHRhdA0KICAgICogQHJldHVybiBzdHJpbmcsIHJlcHJlc2VudGFudCBsZSBkYXRlIGZvcm1hdA0KICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGZvcm1hdCgkZm9ybWF0LCAkY2IgPSBudWxsKQ0KICAgIHsNCg0KICAgICAgICAkZGF0ZSA9IFxkYXRlKCRmb3JtYXQpOw0KDQogICAgICAgIGlmKCRjYiAhPT0gbnVsbCkNCiAgICAgICAgew0KDQogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkY2IsICRkYXRlKTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICRkYXRlOw0KDQogICAgfQ0KDQoNCiAgICAvKioNCiAgICAqIGFkZERheSwgZm9uY3Rpb24gcGVybWV0YW50IGQnYWpvdXRlciBkZXMgam91cnMNCiAgICAqIEBwYXJhbSBpbnQsIHVuIHRpbWVzdGFucA0KICAgICogQHJldHVybiBEb29EYXRlTWFrZXIsIGF2ZWMgbCdham91dCBkZXMgam91cnMNCiAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGREYXkoJGRheU51bWJlcikNCiAgICB7DQoNCiAgICAgICAgcmV0dXJuIG5ldyBEb29EYXRlTWFrZXIoJHRoaXMtPnRpbWVzdGFucCArICgkZGF5TnVtYmVyICogMjQgKiAzNjAwKSwgJHRoaXMtPmxvY2FsKTsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICogYWRkTW9udGgsIGZvbmN0aW9uIHBlcm1ldGFudCBkJ2Fqb3V0ZXIgZGVzIG1vaXMNCiAgICAqDQogICAgKiBAcGFyYW0gaW50ICRtb250aE51bWJlciwgdW4gdGltZXN0YW1wDQogICAgKiBAcGFyYW0gbnVsbCAkY2IsIHVuIGNhbGxhYmxlDQogICAgKiBAcmV0dXJuIERvb0RhdGVNYWtlciwgYXZlYyBsJ2Fqb3V0IGRlcyBqb3Vycw0KICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGFkZE1vbnRoKCRtb250aE51bWJlciwgJGNiID0gbnVsbCkNCiAgICB7DQogICAgICAgIGlmKCRtb250aE51bWJlciA8IDApDQogICAgICAgIHsNCg0KICAgICAgICAgICAgaWYoJGNiICE9PSBudWxsKQ0KICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmMoJGNiLCBuZXcgXEV4Y2VwdGlvbigiRXJyb3IsIHZlcmlmeSBvZmZzZXQgPT4gbm90IGFjY2VwdGVkIG5lZ2F0aXZlIG9mZnNldCIpKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KDQogICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigiRXJyb3IsIHZlcmlmeSBvZmZzZXQgPT4gbm90IGFjY2VwdGVkIG5lZ2F0aXZlIG9mZnNldCIsIEVfVVNFUl9XQVJOSU5HKTsNCg0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgfQ0KDQogICAgICAgICRtb250aCA9IFsNCiAgICAgICAgICAgIDMxLCAyOCwgMzEsDQogICAgICAgICAgICAzMCwgMzEsIDMwLA0KICAgICAgICAgICAgMzEsIDMxLCAzMCwNCiAgICAgICAgICAgIDMxLCAzMCwgMzENCiAgICAgICAgXTsNCg0KICAgICAgICAkc29tT2ZEYXkgPSAwOw0KDQogICAgICAgICRpID0gJHRoaXMtPm1vbnRoT2ZZZWFyOw0KDQogICAgICAgIHdoaWxlKCRtb250aE51bWJlci0tKQ0KICAgICAgICB7DQoNCiAgICAgICAgICAgIGlmKCRpID4gMTEpew0KICAgICAgICAgICAgICAgICRpID0gMDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJHNvbU9mRGF5ICs9ICRtb250aFskaV07DQogICAgICAgICAgICAkaSsrOw0KDQogICAgICAgIH0NCg0KICAgICAgICAkciA9ICRzb21PZkRheSArICgkbW9udGhbJHRoaXMtPm1vbnRoT2ZZZWFyIC0gMV0gLSAkdGhpcy0+ZGF5T2ZNb250aCk7DQoNCiAgICAgICAgcmV0dXJuIG5ldyBEb29EYXRlTWFrZXIodGltZSgpICsgKCRyICogMjQgKiAzNjAwKSwgJHRoaXMtPmxvY2FsKTsNCg0KICAgIH0NCg0KICAgIC8qKg0KICAgICogc2Vjb25kcywgZm9uY3Rpb24gcGVybWV0YW50IGRlIHJlY3VwZXJlciBsZXMgc2Vjb25kcw0KICAgICoNCiAgICAqIEByZXR1cm4gaW50LCBub21icmUgZGUgc2Vjb25kcw0KICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIHNlY29uZHMoKQ0KICAgIHsNCg0KICAgICAgICByZXR1cm4gJHRoaXMtPnNlY29uZHM7DQoNCiAgICB9DQoNCg0KICAgIC8qKg0KICAgICogaG91cnMsIGZvbmN0aW9uIHBlcm1ldGFudCBkZSByZWN1cGVyZXIgbGVzIGhldXJlcw0KICAgICoNCiAgICAqIEByZXR1cm4gaW50LCBub21icmUgZGUgaGV1cmVzDQogICAgKi8NCiAgICBwdWJsaWMgZnVuY3Rpb24gaG91cnMoKQ0KICAgIHsNCg0KICAgICAgICByZXR1cm4gJHRoaXMtPmhvdXJzOw0KDQogICAgfQ0KDQogICAgLyoqDQogICAgKiBtaW51dGVzLCBmb25jdGlvbiBwZXJtZXRhbnQgZGUgcmVjdXBlcmVyIGxlcyBtaW51dGVzDQogICAgKg0KICAgICogQHJldHVybiBpbnQsIG5vbWJyZSBkZSBtaW51dGUNCiAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBtaW51dGVzKCkNCiAgICB7DQoNCiAgICAgICAgcmV0dXJuICR0aGlzLT5taW51dGVzOw0KDQogICAgfQ0KDQp9DQo=
EOPAGE;

$data["artisan"] = <<< EOPAGE
IyEvdXNyL2Jpbi9ldm4gcGhwDQo8P3BocA0KDQoJZGVmaW5lKCJQUk9KRUNUX0NSRUFURUQiLCAzKTsNCiAgICBkZWZpbmUoIkFQUF9OQU1FX05PVF9WQUxJREUiLCA0KTsNCiAgICBkZWZpbmUoIkFQUF9FWElTVFMiLCA1KTsNCiAgICBkZWZpbmUoIkFQUF9OT1RfR0lWRU4iLCA3KTsNCg0KICAgIGRlZmluZSgiRFNOX05PVF9WQUxJREUiLCAxKTsNCiAgICBkZWZpbmUoIkRTTl9DUkVBVEVEIiwgMik7DQogICAgZGVmaW5lKCJEU05fQ09ORl9FWElTVFMiLCA2KTsNCg0KIAlzd2l0Y2goJGFyZ3ZbMV0pIHsNCg0KICAgICAgICBjYXNlICJkc24iOg0KDQogICAgICAgICAgICBpZighZW1wdHkoJGFyZ3ZbMl0pICYmICRhcmd2WzJdID09ICItLXJlbW92ZSIpIHsNCg0KICAgICAgICAgICAgICAgIGlmKCFpc19kaXIoIkRvbyIpKSB7DQoNCiAgICAgICAgICAgICAgICAgICAgZGllKCJZb3UgYXJlbid0IGluIHlvdXIgcHJvamVjdCBmb2xkZXIuXG4gRG8gY2QgTXlBcHBGb2xkZXIgYW5kIGV4ZWN1dGUgY29tbWFuZCBcblx0cGhwIGFydGlzYW4gZHNuIFlvdXItZHNuIik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgJHN0YXR1cyA9IEBzaGVsbF9leGVjKCJybSAtciAuLy5jb25maWcgMj4gLi8ubG9nIik7DQoNCiAgICAgICAgICAgICAgICBpZihpc19udWxsKCRzdGF0dXMpKSB7DQoNCiAgICAgICAgICAgICAgICAgICAgZGllKCJEc24tY29uZmlnIG5vdC1mb3VuZC5cbiIpOw0KDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgZGllKCJZb3VyLWRzbiBpcyByZW1vdmVkLlxuIik7DQoNCiAgICAgICAgICAgIH0gZWxzZSBpZihpc3NldCgkYXJndlsyXSkgJiYgJGFyZ3ZbMl0gIT0gIi0tcmVtb3ZlIiAgJiYgIWlzc2V0KCRhcmd2WzNdKSkgew0KDQogICAgICAgICAgICAgICAgY3JlYXRlRHNuKCRhcmd2WzJdLCAnbmV3JywgIi4iKTsNCiAgICAgICAgICAgICAgICBkaWUoIkRzbi1jb25maWcgY3JlYXRlZC5cbiIpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9IGVsc2UgaWYgKGlzc2V0KCRhcmd2WzJdKSAmJiBpc3NldCgkYXJndlszXSkgJiYgJGFyZ3ZbM10gPT0gIi0tdXBkYXRlIikgew0KDQogICAgICAgICAgICAgICAgY3JlYXRlRHNuKCRhcmd2WzJdLCAndXBkYXRlJywgIi4iKTsNCiAgICAgICAgICAgICAgICBkaWUoIlVwLXRvLWRhdGUgZHNuIHN1Y2Nlc3MuXG4iKTsNCg0KICAgICAgICAgICAgfSBlbHNlIHsNCg0KICAgICAgICAgICAgICAgIGRpZSgiRmF0YWwgZXJyb3IgZHVlIHRvIG5vdCB2YWx1ZSBnaXZlbiBhdCBkc24gY29tbWFuZFxuVXNhZ2UgOiBhcnRpc2FuIGRzbiBteXNxbDovL3VzZXJuYW1lQGxvY2FsaG9zdC9kYXRhYmFzZVxuXG5cdC0tdXBkYXRlIFRvIHVwZGF0ZSBZb3VyIGRzblxuIik7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYnJlYWs7DQogICAgfQ0KDQoJZnVuY3Rpb24gdmVyaWZ5RHNuKCRkbnMpIHsNCg0KCSAgICByZXR1cm4gcHJlZ19tYXRjaCgiIyhwZ3NxbHxteXNxbHxzcWxpdGUpOi8vW1xTXSs6PyhbXFNdKyk/QFtcU106PyhbXFNdKykvW1x3XGRdKyMiLCAkZG5zKTsNCg0KCX0NCg0KCWZ1bmN0aW9uIGNyZWF0ZURzbigkZHNuLCAkYWN0aW9uLCAkcGF0aCkgew0KDQoJICAgIGlmKCRhY3Rpb24gPT09ICJ1cGRhdGUiKSB7DQoNCgkgICAgICAgIGlmKGZpbGVfZXhpc3RzKCIke3BhdGh9Ly5jb25mLy5kc24iKSkgew0KDQoJICAgICAgICAgICAgZmlsZV9wdXRfY29udGVudHMoIiR7cGF0aH0vLmNvbmZpZy8uZHNuIiwgIkROUz0iIC4gYmFzZTY0X2VuY29kZSgkZHNuKSk7DQoNCgkgICAgICAgIH0gZWxzZSB7DQoNCgkgICAgICAgICAgICBjcmVhdGVEc24oJGRzbiwgIm5ldyIsICRwYXRoKTsNCgkgICAgICAgIA0KCSAgICAgICAgfQ0KCSAgICANCgkgICAgfSBlbHNlIGlmICgkYWN0aW9uID09PSAibmV3Iikgew0KDQoJICAgICAgICBpZighdmVyaWZ5RHNuKCRkc24pKSB7DQoJICAgICAgICAgICAgIA0KCSAgICAgICAgfQ0KDQoJICAgICAgICBpZihpc19kaXIoIi4vLmNvbmZpZyIpKSB7DQoNCgkgICAgICAgICAgICBtYWtlTWVzc2FnZShEU05fQ09ORl9FWElTVFMpOw0KDQoJICAgICAgICB9DQoNCgkgICAgICAgIG1rZGlyKCJ7JHBhdGh9Ly5jb25maWciLCAwNzc3KTsNCgkgICAgICAgIHRvdWNoKCJ7JHBhdGh9Ly5jb25maWcvLmRzbiIpOw0KCSAgICAgICAgZmlsZV9wdXRfY29udGVudHMoInskcGF0aH0vLmNvbmZpZy8uZHNuIiwgYmFzZTY0X2VuY29kZSgkZHNuKSk7DQoJICAgIH0NCgl9DQoNCglmdW5jdGlvbiBtYWtlTWVzc2FnZSgkZXJybm8gPSBudWxsKSB7DQoNCiAgICBpZigkZXJybm8gPT09IERTTl9OT1RfVkFMSURFKSB7DQoNCiAgICAgICAgZGllKCJZb3VyLURzbiBpcyBub3QgdmFsaWRlLlxuXHRVc2FnZSBkc24gZS5nIG15c3FsOi8vdXNlcm5hbWVbOnBhc3N3b3JkXUBob3N0bmFtZVs6cG9ydF0vZGF0YWJhc2UiKTsNCg0KICAgIH0gZWxzZSBpZigkZXJybm8gPT09IEFQUF9OQU1FX05PVF9WQUxJREUpIHsNCg0KICAgICAgICBkaWUoIlByb2plY3QgbmFtZSBpcyBub3QgdmFsYWJsZSIpOw0KDQogICAgfSBlbHNlIGlmKCRlcnJubyA9PT0gRFNOX0NPTkZfRVhJU1RTKSB7DQoNCiAgICAgICAgZGllKCJBIG90aGVyIERzbi1jb25maWcgZXhpc3QsIHNvIHVwZGF0ZSBpdCBvciByZW1vdmUgaXQuXG5Vc2FnZSBkb28gZHNuIHlvdXJkc24gLS11cGRhdGUsIHRvIHVwZGF0ZVxuIik7DQoNCiAgICB9IGVsc2UgaWYoJGVycm5vID09PSBBUFBfRVhJU1RTKSB7DQoNCiAgICAgICAgZGllKCJQcm9qZWN0IGV4c2l0cyBpbiB0aGlzIGZvbGRlci5cblx0VXNhZ2UgZG9vIHJlbmFtZSAvbG9zdC9wYXRoIC9uZXcvcGF0aCBhcHBcbiIpOw0KDQogICAgfQ0KfQ0K
EOPAGE;

    if($projetName) {
        
        $path = $projetName;

    } else {

        $path = "App";

    }

    if(!is_dir($path)) {
        
        mkdir("${path}/Doo", 0777, true);

    } else {

        echo "This project exists ...\n";
        die();

    }

    $paths["dir"] = [

        "controller" => "/controller",
        "model" => "/model",
        "views" => "/views",
        "public" => "/public",
        "js" => "/public/js",
        "css" => "/public/css",
        "images" => "/public/images"

    ];

    $paths["file"]["root"] = [

        "autoload" => "Doo/Autoload.php",
        "doo" => "Doo/Doo.php",
        "doodata" => "Doo/Doodata.php",
        "doodatemaker" => "Doo/DoodateMaker.php",
        "doodb" => "Doo/Doodb.php",
        "doomail" => "Doo/Doomail.php",
        "artisan" => "artisan"

    ];

    $paths["file"]["other"] = [

        "js" => "public/js/app.js",
        "css" => "public/css/style.css",
        "index" => "index.php"

    ];

    foreach($paths["dir"] as $key => $value) {

        mkdir("${path}/{$value}", 0777);
    
    }

    foreach($paths["file"]["other"] as $key => $value) {
    
        touch("{$path}/{$value}");
    
    }

    foreach($paths["file"]["root"] as $key => $value) {

        touch("${path}/{$value}");
        file_put_contents("${path}/{$value}", base64_decode($data[$key]));
    
    }

    $h = strtoupper($path);
    
    views($h);
    
    return $path;

}

function createDsn($dsn, $path) {
    
        mkdir("{$path}/.config", 0777);
        touch("{$path}/.config/.dsn");
        file_put_contents("{$path}/.config/.dsn", "{*" . base64_encode($dsn) . "-}");
        die("Dsn-created.\n");

}

function verifyDsn($dns) {

    return preg_match("#(pgsql|mysql|sqlite)://[\S]+:?([\S]+)?@[\S]:?([\S]+)/[\w\d]+#", $dns);

}

function views($h) {

    echo "\n* Project name: <${h}>\n\n|_Doo/\n.  |_Autoload.php\n.  |_Doo.php\n.  |_Doodata.php\n.  |_DooDataMaker.php\n.  |_Doodb.php\n.  |_DooMaili.php\n";
    echo "|_model\n|_views\n|_controller\n|_index.php\n|_artisan\n";
    echo "\n* Doo project created\n";

}